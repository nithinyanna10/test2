
<!DOCTYPE html>


<html lang="en" data-content_root="../" >

  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="viewport" content="width=device-width, initial-scale=1" />

    <title>&lt;no title&gt; &#8212; My Jupyter Book</title>
  
  
  
  <script data-cfasync="false">
    document.documentElement.dataset.mode = localStorage.getItem("mode") || "";
    document.documentElement.dataset.theme = localStorage.getItem("theme") || "";
  </script>
  <!--
    this give us a css class that will be invisible only if js is disabled
  -->
  <noscript>
    <style>
      .pst-js-only { display: none !important; }

    </style>
  </noscript>
  
  <!-- Loaded before other Sphinx assets -->
  <link href="../_static/styles/theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />
<link href="../_static/styles/pydata-sphinx-theme.css?digest=8878045cc6db502f8baf" rel="stylesheet" />

    <link rel="stylesheet" type="text/css" href="../_static/pygments.css?v=b76e3c8a" />
    <link rel="stylesheet" type="text/css" href="../_static/styles/sphinx-book-theme.css?v=a3416100" />
    <link rel="stylesheet" type="text/css" href="../_static/togglebutton.css?v=13237357" />
    <link rel="stylesheet" type="text/css" href="../_static/copybutton.css?v=76b2166b" />
    <link rel="stylesheet" type="text/css" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-thebe.css?v=4fa983c6" />
    <link rel="stylesheet" type="text/css" href="../_static/sphinx-design.min.css?v=95c83b7e" />
  
  <!-- So that users can add custom icons -->
  <script src="../_static/scripts/fontawesome.js?digest=8878045cc6db502f8baf"></script>
  <!-- Pre-loaded scripts that we'll load fully later -->
  <link rel="preload" as="script" href="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf" />
<link rel="preload" as="script" href="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf" />

    <script src="../_static/documentation_options.js?v=9eb32ce0"></script>
    <script src="../_static/doctools.js?v=9a2dae69"></script>
    <script src="../_static/sphinx_highlight.js?v=dc90522c"></script>
    <script src="../_static/clipboard.min.js?v=a7894cd8"></script>
    <script src="../_static/copybutton.js?v=f281be69"></script>
    <script src="../_static/scripts/sphinx-book-theme.js?v=887ef09a"></script>
    <script>let toggleHintShow = 'Click to show';</script>
    <script>let toggleHintHide = 'Click to hide';</script>
    <script>let toggleOpenOnPrint = 'true';</script>
    <script src="../_static/togglebutton.js?v=4a39c7ea"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script src="../_static/design-tabs.js?v=f930bc37"></script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script async="async" src="../_static/sphinx-thebe.js?v=c100c467"></script>
    <script>var togglebuttonSelector = '.toggle, .admonition.dropdown';</script>
    <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script>DOCUMENTATION_OPTIONS.pagename = 'content/503 PROJECT 50593872';</script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <meta name="docsearch:language" content="en"/>
  <meta name="docsearch:version" content="" />
  </head>
  
  
  <body data-bs-spy="scroll" data-bs-target=".bd-toc-nav" data-offset="180" data-bs-root-margin="0px 0px -60%" data-default-mode="">

  
  
  <div id="pst-skip-link" class="skip-link d-print-none"><a href="#main-content">Skip to main content</a></div>
  
  <div id="pst-scroll-pixel-helper"></div>
  
  <button type="button" class="btn rounded-pill" id="pst-back-to-top">
    <i class="fa-solid fa-arrow-up"></i>Back to top</button>

  
  <dialog id="pst-search-dialog">
    
<form class="bd-search d-flex align-items-center"
      action="../search.html"
      method="get">
  <i class="fa-solid fa-magnifying-glass"></i>
  <input type="search"
         class="form-control"
         name="q"
         placeholder="Search this book..."
         aria-label="Search this book..."
         autocomplete="off"
         autocorrect="off"
         autocapitalize="off"
         spellcheck="false"/>
  <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd>K</kbd></span>
</form>
  </dialog>

  <div class="pst-async-banner-revealer d-none">
  <aside id="bd-header-version-warning" class="d-none d-print-none" aria-label="Version warning"></aside>
</div>

  
    <header class="bd-header navbar navbar-expand-lg bd-navbar d-print-none">
    </header>
  

  <div class="bd-container">
    <div class="bd-container__inner bd-page-width">
      
      
      
        
      
      <dialog id="pst-primary-sidebar-modal"></dialog>
      <div id="pst-primary-sidebar" class="bd-sidebar-primary bd-sidebar">
        

  
  <div class="sidebar-header-items sidebar-primary__section">
    
    
    
    
  </div>
  
    <div class="sidebar-primary-items__start sidebar-primary__section">
        <div class="sidebar-primary-item">

  
    
  

<a class="navbar-brand logo" href="#">
  
  
  
  
  
  
    <p class="title logo__title">My Jupyter Book</p>
  
</a></div>
        <div class="sidebar-primary-item">

<button class="btn search-button-field search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
 <i class="fa-solid fa-magnifying-glass"></i>
 <span class="search-button__default-text">Search</span>
 <span class="search-button__kbd-shortcut"><kbd class="kbd-shortcut__modifier">Ctrl</kbd>+<kbd class="kbd-shortcut__modifier">K</kbd></span>
</button></div>
        <div class="sidebar-primary-item"><nav class="bd-links bd-docs-nav" aria-label="Main">
    <div class="bd-toc-item navbar-nav active">
        
        <ul class="nav bd-sidenav bd-sidenav__home-link">
            <li class="toctree-l1 current active">
                <a class="reference internal" href="#">
                    <no title>
                </a>
            </li>
        </ul>
        
    </div>
</nav></div>
    </div>
  
  
  <div class="sidebar-primary-items__end sidebar-primary__section">
      <div class="sidebar-primary-item">
<div id="ethical-ad-placement"
      class="flat"
      data-ea-publisher="readthedocs"
      data-ea-type="readthedocs-sidebar"
      data-ea-manual="true">
</div></div>
  </div>


      </div>
      
      <main id="main-content" class="bd-main" role="main">
        
        

<div class="sbt-scroll-pixel-helper"></div>

          <div class="bd-content">
            <div class="bd-article-container">
              
              <div class="bd-header-article d-print-none">
<div class="header-article-items header-article__inner">
  
    <div class="header-article-items__start">
      
        <div class="header-article-item"><button class="sidebar-toggle primary-toggle btn btn-sm" title="Toggle primary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
  <span class="fa-solid fa-bars"></span>
</button></div>
      
    </div>
  
  
    <div class="header-article-items__end">
      
        <div class="header-article-item">

<div class="article-header-buttons">





<div class="dropdown dropdown-download-buttons">
  <button class="btn dropdown-toggle" type="button" data-bs-toggle="dropdown" aria-expanded="false" aria-label="Download this page">
    <i class="fas fa-download"></i>
  </button>
  <ul class="dropdown-menu">
      
      
      
      <li><a href="../_sources/content/503 PROJECT 50593872.ipynb" target="_blank"
   class="btn btn-sm btn-download-source-button dropdown-item"
   title="Download source file"
   data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file"></i>
  </span>
<span class="btn__text-container">.ipynb</span>
</a>
</li>
      
      
      
      
      <li>
<button onclick="window.print()"
  class="btn btn-sm btn-download-pdf-button dropdown-item"
  title="Print to PDF"
  data-bs-placement="left" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-file-pdf"></i>
  </span>
<span class="btn__text-container">.pdf</span>
</button>
</li>
      
  </ul>
</div>




<button onclick="toggleFullScreen()"
  class="btn btn-sm btn-fullscreen-button"
  title="Fullscreen mode"
  data-bs-placement="bottom" data-bs-toggle="tooltip"
>
  

<span class="btn__icon-container">
  <i class="fas fa-expand"></i>
  </span>

</button>



<button class="btn btn-sm nav-link pst-navbar-icon theme-switch-button pst-js-only" aria-label="Color mode" data-bs-title="Color mode"  data-bs-placement="bottom" data-bs-toggle="tooltip">
  <i class="theme-switch fa-solid fa-sun                fa-lg" data-mode="light" title="Light"></i>
  <i class="theme-switch fa-solid fa-moon               fa-lg" data-mode="dark"  title="Dark"></i>
  <i class="theme-switch fa-solid fa-circle-half-stroke fa-lg" data-mode="auto"  title="System Settings"></i>
</button>


<button class="btn btn-sm pst-navbar-icon search-button search-button__button pst-js-only" title="Search" aria-label="Search" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <i class="fa-solid fa-magnifying-glass fa-lg"></i>
</button>
<button class="sidebar-toggle secondary-toggle btn btn-sm" title="Toggle secondary sidebar" data-bs-placement="bottom" data-bs-toggle="tooltip">
    <span class="fa-solid fa-list"></span>
</button>
</div></div>
      
    </div>
  
</div>
</div>
              
              

<div id="jb-print-docs-body" class="onlyprint">
    <h1><no title></h1>
    <!-- Table of contents -->
    <div id="print-main-content">
        <div id="jb-print-toc">
            
            <div>
                <h2> Contents </h2>
            </div>
            <nav aria-label="Page">
                <ul class="simple visible nav section-nav flex-column">
</ul>

            </nav>
        </div>
    </div>
</div>

              
                
<div id="searchbox"></div>
                <article class="bd-article">
                  
  <div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">project</span> <span class="n">title</span><span class="o">-</span><span class="n">loan</span> <span class="n">prediction</span> 
</pre></div>
</div>
</div>
</div>
<p>LINKS RELATED TO PROJECT</p>
<p>f1-scores and accuracies - <a class="reference external" href="https://buffalo.box.com/s/f35i4pfe75kk7y32pesxi3839wnidm69">https://buffalo.box.com/s/f35i4pfe75kk7y32pesxi3839wnidm69</a></p>
<p>VIDEO -  <a class="reference external" href="https://buffalo.box.com/s/48apuk09ezfz2ke48hio01gnpk81dqka">https://buffalo.box.com/s/48apuk09ezfz2ke48hio01gnpk81dqka</a></p>
<p>MLFLOW -  <a class="reference external" href="https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0?searchFilter=&amp;amp;orderByKey=attributes.start_time&amp;amp;orderByAsc=false&amp;amp;startTime=ALL&amp;amp;lifecycleFilter=Active&amp;amp;modelVersionFilter=All+Runs&amp;amp;datasetsFilter=W10%3D">https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0?searchFilter=&amp;orderByKey=attributes.start_time&amp;orderByAsc=false&amp;startTime=ALL&amp;lifecycleFilter=Active&amp;modelVersionFilter=All+Runs&amp;datasetsFilter=W10%3D</a></p>
<p>DAGSHUB - <a class="reference external" href="https://dagshub.com/nithinyanna3/my-first-repo/experiments">https://dagshub.com/nithinyanna3/my-first-repo/experiments</a></p>
<p>DOCKER - <a class="reference external" href="https://hub.docker.com/r/nithinyanna/fastapi-app/tags">https://hub.docker.com/r/nithinyanna/fastapi-app/tags</a></p>
<p>Streamlit(cloud deployment) - <a class="reference external" href="https://streamlit-app-p2gr.onrender.com/">https://streamlit-app-p2gr.onrender.com/</a></p>
<p>creating a database and loading with the data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">csv</span>

<span class="c1"># Connect to SQLite database (or create it)</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;loan_db.db&quot;</span><span class="p">)</span>
<span class="n">cursor</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">cursor</span><span class="p">()</span>

<span class="c1"># Create tables (Person, Loan, Credit, LoanStatus)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS Person (</span>
<span class="s1">                    person_id INTEGER PRIMARY KEY,</span>
<span class="s1">                    person_age INTEGER,</span>
<span class="s1">                    person_income INTEGER,</span>
<span class="s1">                    person_home_ownership TEXT,</span>
<span class="s1">                    person_emp_length INTEGER);&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS Loan (</span>
<span class="s1">                    loan_id INTEGER PRIMARY KEY,</span>
<span class="s1">                    person_id INTEGER,</span>
<span class="s1">                    loan_intent TEXT,</span>
<span class="s1">                    loan_grade TEXT,</span>
<span class="s1">                    loan_amnt INTEGER,</span>
<span class="s1">                    loan_int_rate REAL,</span>
<span class="s1">                    loan_percent_income REAL,</span>
<span class="s1">                    FOREIGN KEY(person_id) REFERENCES Person(person_id));&#39;&#39;&#39;</span><span class="p">)</span>
<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS Credit (</span>
<span class="s1">                    credit_id INTEGER PRIMARY KEY,</span>
<span class="s1">                    person_id INTEGER,</span>
<span class="s1">                    cb_person_default_on_file TEXT,</span>
<span class="s1">                    cb_person_cred_hist_length INTEGER,</span>
<span class="s1">                    FOREIGN KEY(person_id) REFERENCES Person(person_id));&#39;&#39;&#39;</span><span class="p">)</span>

<span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;CREATE TABLE IF NOT EXISTS LoanStatus (</span>
<span class="s1">                    loan_status_id INTEGER PRIMARY KEY,</span>
<span class="s1">                    loan_id INTEGER,</span>
<span class="s1">                    loan_status INTEGER,</span>
<span class="s1">                    FOREIGN KEY(loan_id) REFERENCES Loan(loan_id));&#39;&#39;&#39;</span><span class="p">)</span>

<span class="c1"># Parse the CSV file and insert data into tables</span>
<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">HP</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">train.csv&quot;</span><span class="p">,</span> <span class="s1">&#39;r&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">reader</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">DictReader</span><span class="p">(</span><span class="n">file</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">reader</span><span class="p">:</span>
        <span class="c1"># Insert into Person table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT OR IGNORE INTO Person (person_id, person_age, person_income, person_home_ownership, person_emp_length)</span>
<span class="s1">                          VALUES (?, ?, ?, ?, ?)&#39;&#39;&#39;</span><span class="p">,</span> 
                       <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;person_income&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;person_emp_length&#39;</span><span class="p">]))</span>
        
        <span class="c1"># Insert into Loan table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT OR IGNORE INTO Loan (loan_id, person_id, loan_intent, loan_grade, loan_amnt, loan_int_rate, loan_percent_income)</span>
<span class="s1">                          VALUES (?, ?, ?, ?, ?, ?, ?)&#39;&#39;&#39;</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_int_rate&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_percent_income&#39;</span><span class="p">]))</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT OR IGNORE INTO Credit (credit_id, person_id, cb_person_default_on_file, cb_person_cred_hist_length)</span>
<span class="s1">                          VALUES (?, ?, ?, ?)&#39;&#39;&#39;</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;cb_person_cred_hist_length&#39;</span><span class="p">]))</span>
        
        <span class="c1"># Insert into LoanStatus table</span>
        <span class="n">cursor</span><span class="o">.</span><span class="n">execute</span><span class="p">(</span><span class="s1">&#39;&#39;&#39;INSERT OR IGNORE INTO LoanStatus (loan_status_id, loan_id, loan_status)</span>
<span class="s1">                          VALUES (?, ?, ?)&#39;&#39;&#39;</span><span class="p">,</span>
                       <span class="p">(</span><span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;id&#39;</span><span class="p">],</span> <span class="n">row</span><span class="p">[</span><span class="s1">&#39;loan_status&#39;</span><span class="p">]))</span>

<span class="c1"># Commit the changes and close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">commit</span><span class="p">()</span>
        
        <span class="c1"># Insert into Credit table</span>
</pre></div>
</div>
</div>
</div>
<p>joining tables via sql queries</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">sqlite3</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Connect to the SQLite database</span>
<span class="n">conn</span> <span class="o">=</span> <span class="n">sqlite3</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="s2">&quot;normalized_db.db&quot;</span><span class="p">)</span>

<span class="c1"># SQL query to join the tables and reconstruct the data</span>
<span class="n">query</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">SELECT p.person_id, p.person_age, p.person_income, p.person_home_ownership, p.person_emp_length,</span>
<span class="s2">       l.loan_id, l.loan_intent, l.loan_grade, l.loan_amnt, l.loan_int_rate, l.loan_percent_income,</span>
<span class="s2">       c.cb_person_default_on_file, c.cb_person_cred_hist_length, ls.loan_status</span>
<span class="s2">FROM Person p</span>
<span class="s2">JOIN Loan l ON p.person_id = l.person_id</span>
<span class="s2">JOIN Credit c ON p.person_id = c.person_id</span>
<span class="s2">JOIN LoanStatus ls ON l.loan_id = ls.loan_id;</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Execute the query and load the result into a Pandas DataFrame</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_sql</span><span class="p">(</span><span class="n">query</span><span class="p">,</span> <span class="n">conn</span><span class="p">)</span>

<span class="c1"># Close the connection</span>
<span class="n">conn</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>

<span class="c1"># Print the resulting DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       person_id  person_age  person_income person_home_ownership  \
0              0          37          35000                  RENT   
1              1          22          56000                   OWN   
2              2          29          28800                   OWN   
3              3          30          70000                  RENT   
4              4          22          60000                  RENT   
...          ...         ...            ...                   ...   
58640      58640          34         120000              MORTGAGE   
58641      58641          28          28800                  RENT   
58642      58642          23          44000                  RENT   
58643      58643          22          30000                  RENT   
58644      58644          31          75000              MORTGAGE   

       person_emp_length  loan_id loan_intent loan_grade  loan_amnt  \
0                      0        0   EDUCATION          B       6000   
1                      6        1     MEDICAL          C       4000   
2                      8        2    PERSONAL          A       6000   
3                     14        3     VENTURE          B      12000   
4                      2        4     MEDICAL          A       6000   
...                  ...      ...         ...        ...        ...   
58640                  5    58640   EDUCATION          D      25000   
58641                  0    58641     MEDICAL          C      10000   
58642                  7    58642   EDUCATION          D       6800   
58643                  2    58643   EDUCATION          A       5000   
58644                  2    58644     VENTURE          B      15000   

       loan_int_rate  loan_percent_income cb_person_default_on_file  \
0              11.49                 0.17                         N   
1              13.35                 0.07                         N   
2               8.90                 0.21                         N   
3              11.11                 0.17                         N   
4               6.92                 0.10                         N   
...              ...                  ...                       ...   
58640          15.95                 0.21                         Y   
58641          12.73                 0.35                         N   
58642          16.00                 0.15                         N   
58643           8.90                 0.17                         N   
58644          11.11                 0.20                         N   

       cb_person_cred_hist_length  loan_status  
0                              14            0  
1                               2            0  
2                              10            0  
3                               5            0  
4                               3            0  
...                           ...          ...  
58640                          10            0  
58641                           8            1  
58642                           2            1  
58643                           3            0  
58644                           5            0  

[58645 rows x 14 columns]
</pre></div>
</div>
</div>
</div>
<p>removing non data</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;all&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>removing duplicate rows</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop_duplicates</span><span class="p">()</span>
</pre></div>
</div>
</div>
</div>
<p>remove rows with missing data NAN</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">how</span><span class="o">=</span><span class="s1">&#39;any&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>exploring the dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span> <span class="c1"># Print the entire DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="p">)</span>

<span class="c1"># Print summary statistics</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">describe</span><span class="p">())</span>

<span class="c1"># Print DataFrame information</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">info</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       person_id  person_age  person_income person_home_ownership  \
0              0          37          35000                  RENT   
1              1          22          56000                   OWN   
2              2          29          28800                   OWN   
3              3          30          70000                  RENT   
4              4          22          60000                  RENT   
...          ...         ...            ...                   ...   
58640      58640          34         120000              MORTGAGE   
58641      58641          28          28800                  RENT   
58642      58642          23          44000                  RENT   
58643      58643          22          30000                  RENT   
58644      58644          31          75000              MORTGAGE   

       person_emp_length  loan_id loan_intent loan_grade  loan_amnt  \
0                      0        0   EDUCATION          B       6000   
1                      6        1     MEDICAL          C       4000   
2                      8        2    PERSONAL          A       6000   
3                     14        3     VENTURE          B      12000   
4                      2        4     MEDICAL          A       6000   
...                  ...      ...         ...        ...        ...   
58640                  5    58640   EDUCATION          D      25000   
58641                  0    58641     MEDICAL          C      10000   
58642                  7    58642   EDUCATION          D       6800   
58643                  2    58643   EDUCATION          A       5000   
58644                  2    58644     VENTURE          B      15000   

       loan_int_rate  loan_percent_income cb_person_default_on_file  \
0              11.49                 0.17                         N   
1              13.35                 0.07                         N   
2               8.90                 0.21                         N   
3              11.11                 0.17                         N   
4               6.92                 0.10                         N   
...              ...                  ...                       ...   
58640          15.95                 0.21                         Y   
58641          12.73                 0.35                         N   
58642          16.00                 0.15                         N   
58643           8.90                 0.17                         N   
58644          11.11                 0.20                         N   

       cb_person_cred_hist_length  loan_status  
0                              14            0  
1                               2            0  
2                              10            0  
3                               5            0  
4                               3            0  
...                           ...          ...  
58640                          10            0  
58641                           8            1  
58642                           2            1  
58643                           3            0  
58644                           5            0  

[58645 rows x 14 columns]
          person_id    person_age  person_income  person_emp_length  \
count  58645.000000  58645.000000   5.864500e+04       58645.000000   
mean   29322.000000     27.550857   6.404617e+04           4.701015   
std    16929.497605      6.033216   3.793111e+04           3.959784   
min        0.000000     20.000000   4.200000e+03           0.000000   
25%    14661.000000     23.000000   4.200000e+04           2.000000   
50%    29322.000000     26.000000   5.800000e+04           4.000000   
75%    43983.000000     30.000000   7.560000e+04           7.000000   
max    58644.000000    123.000000   1.900000e+06         123.000000   

            loan_id     loan_amnt  loan_int_rate  loan_percent_income  \
count  58645.000000  58645.000000   58645.000000         58645.000000   
mean   29322.000000   9217.556518      10.677874             0.159238   
std    16929.497605   5563.807384       3.034697             0.091692   
min        0.000000    500.000000       5.420000             0.000000   
25%    14661.000000   5000.000000       7.880000             0.090000   
50%    29322.000000   8000.000000      10.750000             0.140000   
75%    43983.000000  12000.000000      12.990000             0.210000   
max    58644.000000  35000.000000      23.220000             0.830000   

       cb_person_cred_hist_length   loan_status  
count                58645.000000  58645.000000  
mean                     5.813556      0.142382  
std                      4.029196      0.349445  
min                      2.000000      0.000000  
25%                      3.000000      0.000000  
50%                      4.000000      0.000000  
75%                      8.000000      0.000000  
max                     30.000000      1.000000  
&lt;class &#39;pandas.core.frame.DataFrame&#39;&gt;
RangeIndex: 58645 entries, 0 to 58644
Data columns (total 14 columns):
 #   Column                      Non-Null Count  Dtype  
---  ------                      --------------  -----  
 0   person_id                   58645 non-null  int64  
 1   person_age                  58645 non-null  int64  
 2   person_income               58645 non-null  int64  
 3   person_home_ownership       58645 non-null  object 
 4   person_emp_length           58645 non-null  int64  
 5   loan_id                     58645 non-null  int64  
 6   loan_intent                 58645 non-null  object 
 7   loan_grade                  58645 non-null  object 
 8   loan_amnt                   58645 non-null  int64  
 9   loan_int_rate               58645 non-null  float64
 10  loan_percent_income         58645 non-null  float64
 11  cb_person_default_on_file   58645 non-null  object 
 12  cb_person_cred_hist_length  58645 non-null  int64  
 13  loan_status                 58645 non-null  int64  
dtypes: float64(2), int64(8), object(4)
memory usage: 6.3+ MB
None
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">dtypes</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>person_id                       int64
person_age                      int64
person_income                   int64
person_home_ownership          object
person_emp_length               int64
loan_id                         int64
loan_intent                    object
loan_grade                     object
loan_amnt                       int64
loan_int_rate                 float64
loan_percent_income           float64
cb_person_default_on_file      object
cb_person_cred_hist_length      int64
loan_status                     int64
dtype: object
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">loan_grade_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">loan_grade_weights</span><span class="p">)</span>

<span class="c1"># Importance weights for person_home_ownership</span>
<span class="n">home_ownership_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Own&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Mortgage&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Rent&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">home_ownership_weights</span><span class="p">)</span>

<span class="c1"># Importance weights for loan_intent</span>
<span class="n">loan_intent_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Personal&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;Business&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Education&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">loan_intent_weights</span><span class="p">)</span>

<span class="c1"># Importance weights for cb_person_default_on_file</span>
<span class="n">default_on_file_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;No&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Yes&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">default_on_file_weights</span><span class="p">)</span>

<span class="c1"># Handling missing or unrecognized categories by filling with default values (0 or a relevant number)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Display the updated DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_id  person_age  person_income  person_home_ownership  \
0          0          37          35000                      0   
1          1          22          56000                      0   
2          2          29          28800                      0   
3          3          30          70000                      0   
4          4          22          60000                      0   

   person_emp_length  loan_id  loan_intent  loan_grade  loan_amnt  \
0                  0        0            0           2       6000   
1                  6        1            0           3       4000   
2                  8        2            0           1       6000   
3                 14        3            0           2      12000   
4                  2        4            0           1       6000   

   loan_int_rate  loan_percent_income  cb_person_default_on_file  \
0          11.49                 0.17                          0   
1          13.35                 0.07                          0   
2           8.90                 0.21                          0   
3          11.11                 0.17                          0   
4           6.92                 0.10                          0   

   cb_person_cred_hist_length  loan_status  
0                          14            0  
1                           2            0  
2                          10            0  
3                           5            0  
4                           3            0  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Ordinal encoding for loan_grade</span>
<span class="n">loan_grade_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">loan_grade_weights</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># Binary encoding for cb_person_default_on_file</span>
<span class="n">default_on_file_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">}</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">default_on_file_weights</span><span class="p">)</span><span class="o">.</span><span class="n">fillna</span><span class="p">(</span><span class="mi">0</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>

<span class="c1"># One-Hot Encoding for nominal features</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">get_dummies</span><span class="p">(</span><span class="n">df</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_intent&#39;</span><span class="p">],</span> <span class="n">drop_first</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Display updated DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_id  person_age  person_income  person_emp_length  loan_id  \
0          0          37          35000                  0        0   
1          1          22          56000                  6        1   
2          2          29          28800                  8        2   
3          3          30          70000                 14        3   
4          4          22          60000                  2        4   

   loan_grade  loan_amnt  loan_int_rate  loan_percent_income  \
0           0       6000          11.49                 0.17   
1           0       4000          13.35                 0.07   
2           0       6000           8.90                 0.21   
3           0      12000          11.11                 0.17   
4           0       6000           6.92                 0.10   

   cb_person_default_on_file  cb_person_cred_hist_length  loan_status  
0                          0                          14            0  
1                          0                           2            0  
2                          0                          10            0  
3                          0                           5            0  
4                          0                           3            0  
</pre></div>
</div>
</div>
</div>
<p>saving the data as firstupdate for no  confusion</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Save the updated DataFrame in the Jupyter environment with a new variable name</span>
<span class="n">firstupdate</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Save the new DataFrame to a CSV file</span>
<span class="n">output_path_firstupdate</span> <span class="o">=</span> <span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">HP</span><span class="se">\\</span><span class="s2">Downloads</span><span class="se">\\</span><span class="s2">firstupdate.csv&quot;</span>  <span class="c1"># Replace with desired path</span>
<span class="n">firstupdate</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path_firstupdate</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;DataFrame has been saved in the environment as &#39;firstupdate&#39;&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;DataFrame saved to system as: </span><span class="si">{</span><span class="n">output_path_firstupdate</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">firstupdate</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>  <span class="c1"># Display the first few rows</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>DataFrame has been saved in the environment as &#39;firstupdate&#39;
DataFrame saved to system as: C:\Users\HP\Downloads\firstupdate.csv
   person_id  person_age  person_income  person_emp_length  loan_id  \
0          0          37          35000                  0        0   
1          1          22          56000                  6        1   
2          2          29          28800                  8        2   
3          3          30          70000                 14        3   
4          4          22          60000                  2        4   

   loan_grade  loan_amnt  loan_int_rate  loan_percent_income  \
0           0       6000          11.49                 0.17   
1           0       4000          13.35                 0.07   
2           0       6000           8.90                 0.21   
3           0      12000          11.11                 0.17   
4           0       6000           6.92                 0.10   

   cb_person_default_on_file  cb_person_cred_hist_length  loan_status  
0                          0                          14            0  
1                          0                           2            0  
2                          0                          10            0  
3                          0                           5            0  
4                          0                           3            0  
</pre></div>
</div>
</div>
</div>
<p>removing the outliers using mahalonibis distance and saving it as second update</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">scipy.spatial</span> <span class="kn">import</span> <span class="n">distance</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Load the DataFrame from environment</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">firstupdate</span>  <span class="c1"># Assuming &#39;firstupdate&#39; is already available in the environment</span>

<span class="c1"># Select predictors</span>
<span class="n">predictors</span> <span class="o">=</span> <span class="n">df</span><span class="p">[[</span><span class="s1">&#39;person_age&#39;</span><span class="p">,</span> <span class="s1">&#39;person_income&#39;</span><span class="p">,</span> <span class="s1">&#39;person_emp_length&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> 
                 <span class="s1">&#39;loan_int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_percent_income&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_person_cred_hist_length&#39;</span><span class="p">]]</span>

<span class="c1"># Normalize the predictors</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">predictors_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">predictors</span><span class="p">)</span>

<span class="c1"># Calculate the covariance matrix and its inverse</span>
<span class="n">cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cov</span><span class="p">(</span><span class="n">predictors_scaled</span><span class="o">.</span><span class="n">T</span><span class="p">)</span>
<span class="n">inv_cov_matrix</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">cov_matrix</span><span class="p">)</span>

<span class="c1"># Compute the Mahalanobis distances</span>
<span class="n">mahal_distances</span> <span class="o">=</span> <span class="p">[</span><span class="n">distance</span><span class="o">.</span><span class="n">mahalanobis</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">predictors_scaled</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">0</span><span class="p">),</span> <span class="n">inv_cov_matrix</span><span class="p">)</span> 
                   <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">predictors_scaled</span><span class="p">]</span>

<span class="c1"># Add the Mahalanobis distance to the DataFrame</span>
<span class="n">df</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">mahal_distances</span>

<span class="c1"># Identify outliers (using 99th percentile as threshold)</span>
<span class="n">threshold</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">percentile</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">],</span> <span class="mi">99</span><span class="p">)</span>  <span class="c1"># 99th percentile</span>
<span class="n">outliers</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="n">threshold</span><span class="p">]</span>

<span class="c1"># Print the rows that are outliers</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Outlier rows:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">outliers</span><span class="p">)</span>

<span class="c1"># Remove outliers and save the cleaned data to &#39;secondupdate&#39;</span>
<span class="n">secondupdate</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">]</span> <span class="o">&lt;=</span> <span class="n">threshold</span><span class="p">]</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">])</span>

<span class="c1"># Print shapes to confirm</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original shape: </span><span class="si">{</span><span class="n">df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, Shape after removing outliers: </span><span class="si">{</span><span class="n">secondupdate</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Optionally, visualize Mahalanobis distances</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">hist</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;mahalanobis&#39;</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;skyblue&#39;</span><span class="p">,</span> <span class="n">edgecolor</span><span class="o">=</span><span class="s1">&#39;black&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">axvline</span><span class="p">(</span><span class="n">threshold</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="n">linestyle</span><span class="o">=</span><span class="s1">&#39;dashed&#39;</span><span class="p">,</span> <span class="n">linewidth</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Distribution of Mahalanobis Distances&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s2">&quot;Mahalanobis Distance&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s2">&quot;Frequency&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Outlier rows:
       person_id  person_age  person_income  person_emp_length  loan_id  \
91            91          24         225000                  0       91   
583          583          22         250000                  4      583   
597          597          60          45000                  1      597   
967          967          35         150000                 19      967   
1064        1064          46          63000                 19     1064   
...          ...         ...            ...                ...      ...   
57844      57844          55          54000                 17    57844   
58165      58165          27         156000                  9    58165   
58242      58242          53          90000                  7    58242   
58436      58436          53          26500                  1    58436   
58604      58604          62         150000                  3    58604   

       loan_grade  loan_amnt  loan_int_rate  loan_percent_income  \
91              0       3000          14.26                 0.01   
583             0      10000           7.51                 0.04   
597             0       8000          12.99                 0.18   
967             0      35000          18.39                 0.23   
1064            0       7700          18.78                 0.12   
...           ...        ...            ...                  ...   
57844           0       6000          13.48                 0.11   
58165           0      35000          14.27                 0.22   
58242           0       5600           8.63                 0.06   
58436           0       5000          13.79                 0.19   
58604           0      24000          16.95                 0.16   

       cb_person_default_on_file  cb_person_cred_hist_length  loan_status  \
91                             0                           2            0   
583                            0                           3            0   
597                            0                          21            0   
967                            0                           6            0   
1064                           0                          11            0   
...                          ...                         ...          ...   
57844                          0                          18            0   
58165                          0                           8            0   
58242                          0                          30            0   
58436                          0                          30            0   
58604                          0                          20            0   

       mahalanobis  
91        6.154743  
583       5.772778  
597       6.023917  
967       7.165013  
1064      6.192444  
...            ...  
57844     5.869117  
58165     5.968892  
58242     6.482798  
58436     6.748854  
58604     7.514088  

[587 rows x 13 columns]
Original shape: (58645, 13), Shape after removing outliers: (58058, 12)
</pre></div>
</div>
<img alt="../_images/6b9a71a02906b36389d146d905ce285ba28ee19d230be296146fca7cc6bea42e.png" src="../_images/6b9a71a02906b36389d146d905ce285ba28ee19d230be296146fca7cc6bea42e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="nb">print</span><span class="p">(</span><span class="n">secondupdate</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_id  person_age  person_income  person_emp_length  loan_id  \
0          0          37          35000                  0        0   
1          1          22          56000                  6        1   
2          2          29          28800                  8        2   
3          3          30          70000                 14        3   
4          4          22          60000                  2        4   

   loan_grade  loan_amnt  loan_int_rate  loan_percent_income  \
0           0       6000          11.49                 0.17   
1           0       4000          13.35                 0.07   
2           0       6000           8.90                 0.21   
3           0      12000          11.11                 0.17   
4           0       6000           6.92                 0.10   

   cb_person_default_on_file  cb_person_cred_hist_length  loan_status  
0                          0                          14            0  
1                          0                           2            0  
2                          0                          10            0  
3                          0                           5            0  
4                          0                           3            0  
</pre></div>
</div>
</div>
</div>
<p>some exploratory data analysis</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Univariate Analysis: Histogram, Boxplot, and Density Plot</span>

<span class="c1"># List of numeric columns</span>
<span class="n">numeric_columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">,</span> <span class="s1">&#39;person_income&#39;</span><span class="p">,</span> <span class="s1">&#39;person_emp_length&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> 
                   <span class="s1">&#39;loan_int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_percent_income&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_person_cred_hist_length&#39;</span><span class="p">]</span>

<span class="c1"># Plot histograms</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">histplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">kde</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">bins</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> - Histogram&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Boxplots for Outlier Detection</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">boxplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;green&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> - Boxplot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Density Plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">col</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">numeric_columns</span><span class="p">,</span> <span class="mi">1</span><span class="p">):</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">subplot</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">,</span> <span class="n">i</span><span class="p">)</span>
    <span class="n">sns</span><span class="o">.</span><span class="n">kdeplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">col</span><span class="p">],</span> <span class="n">shade</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="n">col</span><span class="si">}</span><span class="s1"> - Density Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">tight_layout</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/cabbc3922cce9791e2c1b92f525e7039d748c284b3e11559daff27c0cbcdc419.png" src="../_images/cabbc3922cce9791e2c1b92f525e7039d748c284b3e11559daff27c0cbcdc419.png" />
<img alt="../_images/1dc863eca5646734691999de0a00a85d6c2ed200a8e764410d8f996de1a4b6e6.png" src="../_images/1dc863eca5646734691999de0a00a85d6c2ed200a8e764410d8f996de1a4b6e6.png" />
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
C:\Users\HP\AppData\Local\Temp\ipykernel_18368\2256259307.py:32: FutureWarning: 

`shade` is now deprecated in favor of `fill`; setting `fill=True`.
This will become an error in seaborn v0.14.0; please update your code.

  sns.kdeplot(df[col], shade=True, color=&#39;purple&#39;)
</pre></div>
</div>
<img alt="../_images/7f7001dacc5778e395116307279c28dbf43ce90576d05f9cbbfa36adc632155c.png" src="../_images/7f7001dacc5778e395116307279c28dbf43ce90576d05f9cbbfa36adc632155c.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Scatter Plots</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">scatterplot</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="s1">&#39;person_income&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">=</span><span class="n">df</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;blue&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Scatter Plot - person_income vs loan_amnt&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Correlation Heatmap</span>
<span class="n">corr_matrix</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">corr_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s1">&#39;coolwarm&#39;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s1">&#39;.2f&#39;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Correlation Heatmap&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Pair Plot</span>
<span class="n">sns</span><span class="o">.</span><span class="n">pairplot</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">],</span> <span class="n">height</span><span class="o">=</span><span class="mf">2.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">suptitle</span><span class="p">(</span><span class="s1">&#39;Pair Plot of Numeric Variables&#39;</span><span class="p">,</span> <span class="n">y</span><span class="o">=</span><span class="mf">1.02</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7689322ab4ddcb096e2b2da1e26e854c02f91c948b936c984903aa24f3798468.png" src="../_images/7689322ab4ddcb096e2b2da1e26e854c02f91c948b936c984903aa24f3798468.png" />
<img alt="../_images/fe793009e343d1a83a64281602ec71e262befca5d90612d10fac3b7b0ff69ad1.png" src="../_images/fe793009e343d1a83a64281602ec71e262befca5d90612d10fac3b7b0ff69ad1.png" />
<img alt="../_images/0291fbdfd612e10080022b5f89e16cb8430f26a4d5b37737e4584c535d496aa4.png" src="../_images/0291fbdfd612e10080022b5f89e16cb8430f26a4d5b37737e4584c535d496aa4.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">mpl_toolkits.mplot3d</span> <span class="kn">import</span> <span class="n">Axes3D</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">LabelEncoder</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Multivariate Analysis: 3D Plot</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">10</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">ax</span> <span class="o">=</span> <span class="n">fig</span><span class="o">.</span><span class="n">add_subplot</span><span class="p">(</span><span class="mi">111</span><span class="p">,</span> <span class="n">projection</span><span class="o">=</span><span class="s1">&#39;3d&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">scatter</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">],</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_int_rate&#39;</span><span class="p">],</span> <span class="n">c</span><span class="o">=</span><span class="s1">&#39;purple&#39;</span><span class="p">,</span> <span class="n">marker</span><span class="o">=</span><span class="s1">&#39;o&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_xlabel</span><span class="p">(</span><span class="s1">&#39;person_age&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_ylabel</span><span class="p">(</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">)</span>
<span class="n">ax</span><span class="o">.</span><span class="n">set_zlabel</span><span class="p">(</span><span class="s1">&#39;loan_int_rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;3D Scatter Plot - person_age, loan_amnt, and loan_int_rate&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

<span class="c1"># Parallel Coordinate Plot (requires normalization)</span>
<span class="kn">from</span> <span class="nn">pandas.plotting</span> <span class="kn">import</span> <span class="n">parallel_coordinates</span>

<span class="c1"># Normalizing data for parallel coordinates plot</span>
<span class="n">df_normalized</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="n">numeric_columns</span><span class="p">]</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
<span class="n">df_normalized</span> <span class="o">=</span> <span class="p">(</span><span class="n">df_normalized</span> <span class="o">-</span> <span class="n">df_normalized</span><span class="o">.</span><span class="n">min</span><span class="p">())</span> <span class="o">/</span> <span class="p">(</span><span class="n">df_normalized</span><span class="o">.</span><span class="n">max</span><span class="p">()</span> <span class="o">-</span> <span class="n">df_normalized</span><span class="o">.</span><span class="n">min</span><span class="p">())</span>

<span class="c1"># Adding a target column for the color differentiation (using loan_status as an example)</span>
<span class="n">df_normalized</span><span class="p">[</span><span class="s1">&#39;loan_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_status&#39;</span><span class="p">]</span>

<span class="c1"># Plotting the parallel coordinate plot</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">6</span><span class="p">))</span>
<span class="n">parallel_coordinates</span><span class="p">(</span><span class="n">df_normalized</span><span class="p">,</span> <span class="s1">&#39;loan_status&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="n">plt</span><span class="o">.</span><span class="n">cm</span><span class="o">.</span><span class="n">viridis</span><span class="p">(</span><span class="n">df_normalized</span><span class="p">[</span><span class="s1">&#39;loan_status&#39;</span><span class="p">]</span><span class="o">/</span><span class="n">df_normalized</span><span class="p">[</span><span class="s1">&#39;loan_status&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">max</span><span class="p">()))</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s1">&#39;Parallel Coordinates Plot&#39;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<img alt="../_images/7604078387e5fb1769a4a6fec2481cc033977f4de5ab754766a0115298d0ef2a.png" src="../_images/7604078387e5fb1769a4a6fec2481cc033977f4de5ab754766a0115298d0ef2a.png" />
<img alt="../_images/4837747f588c01f9298de12d6589590444c7e322b0f205e2339d7d2784a46e70.png" src="../_images/4837747f588c01f9298de12d6589590444c7e322b0f205e2339d7d2784a46e70.png" />
</div>
</div>
<p>transforming the test data</p>
<p>loading the test data and exploring</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Load the test data</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">HP</span><span class="se">\\</span><span class="s1">Downloads</span><span class="se">\\</span><span class="s1">test.csv&#39;</span><span class="p">)</span>

<span class="c1"># Display the head of the test data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>      id  person_age  person_income person_home_ownership  person_emp_length  \
0  58645          23          69000                  RENT                3.0   
1  58646          26          96000              MORTGAGE                6.0   
2  58647          26          30000                  RENT                5.0   
3  58648          33          50000                  RENT                4.0   
4  58649          26         102000              MORTGAGE                8.0   

         loan_intent loan_grade  loan_amnt  loan_int_rate  \
0    HOMEIMPROVEMENT          F      25000          15.76   
1           PERSONAL          C      10000          12.68   
2            VENTURE          E       4000          17.19   
3  DEBTCONSOLIDATION          A       7000           8.90   
4    HOMEIMPROVEMENT          D      15000          16.32   

   loan_percent_income cb_person_default_on_file  cb_person_cred_hist_length  
0                 0.36                         N                           2  
1                 0.10                         Y                           4  
2                 0.13                         Y                           2  
3                 0.14                         N                           7  
4                 0.15                         Y                           4  
</pre></div>
</div>
</div>
</div>
<p>converting the test data into the form of training data for predictions</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Load the test data</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;C:</span><span class="se">\\</span><span class="s1">Users</span><span class="se">\\</span><span class="s1">HP</span><span class="se">\\</span><span class="s1">Downloads</span><span class="se">\\</span><span class="s1">test.csv&#39;</span><span class="p">)</span>

<span class="c1"># Drop the &#39;person_home_ownership&#39; column</span>
<span class="n">test_data</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person_home_ownership&#39;</span><span class="p">,</span><span class="s1">&#39;loan_intent&#39;</span><span class="p">,</span><span class="s1">&#39;id&#39;</span><span class="p">],)</span>

<span class="c1"># Label encoding for required columns</span>
<span class="n">home_ownership_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;Own&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Mortgage&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;Rent&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">}</span>
<span class="n">loan_grade_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;C&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">,</span> <span class="s1">&#39;D&#39;</span><span class="p">:</span> <span class="mi">3</span><span class="p">,</span> <span class="s1">&#39;E&#39;</span><span class="p">:</span> <span class="mi">4</span><span class="p">,</span> <span class="s1">&#39;F&#39;</span><span class="p">:</span> <span class="mi">5</span><span class="p">}</span>

<span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">loan_grade_weights</span><span class="p">)</span>

<span class="c1"># Convert &#39;cb_person_default_on_file&#39; from strings to numeric</span>
<span class="n">default_on_file_weights</span> <span class="o">=</span> <span class="p">{</span><span class="s1">&#39;N&#39;</span><span class="p">:</span> <span class="mi">1</span><span class="p">,</span> <span class="s1">&#39;Y&#39;</span><span class="p">:</span> <span class="mi">2</span><span class="p">}</span>
<span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">test_data</span><span class="p">[</span><span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">default_on_file_weights</span><span class="p">)</span>

<span class="c1"># Save the updated test data to the environment</span>
<span class="n">test_data</span><span class="o">.</span><span class="n">to_pickle</span><span class="p">(</span><span class="s1">&#39;testdata.pkl&#39;</span><span class="p">)</span>

<span class="c1"># Optionally, save it as a CSV</span>
<span class="n">test_data</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s1">&#39;updatedtestdata.csv&#39;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Display the head of the updated test data</span>
<span class="nb">print</span><span class="p">(</span><span class="n">test_data</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_age  person_income  person_emp_length  loan_grade  loan_amnt  \
0          23          69000                3.0         5.0      25000   
1          26          96000                6.0         2.0      10000   
2          26          30000                5.0         4.0       4000   
3          33          50000                4.0         0.0       7000   
4          26         102000                8.0         3.0      15000   

   loan_int_rate  loan_percent_income  cb_person_default_on_file  \
0          15.76                 0.36                          1   
1          12.68                 0.10                          2   
2          17.19                 0.13                          2   
3           8.90                 0.14                          1   
4          16.32                 0.15                          2   

   cb_person_cred_hist_length  
0                           2  
1                           4  
2                           2  
3                           7  
4                           4  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">columns_to_drop</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;person_id&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_id&#39;</span><span class="p">]</span>  <span class="c1"># Add more columns if necessary</span>
<span class="n">secondupdate</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_drop</span><span class="p">)</span>

<span class="c1"># Print the head of the updated DataFrame</span>
<span class="nb">print</span><span class="p">(</span><span class="n">secondupdate</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_age  person_income  person_emp_length  loan_grade  loan_amnt  \
0          37          35000                  0           0       6000   
1          22          56000                  6           0       4000   
2          29          28800                  8           0       6000   
3          30          70000                 14           0      12000   
4          22          60000                  2           0       6000   

   loan_int_rate  loan_percent_income  cb_person_default_on_file  \
0          11.49                 0.17                          0   
1          13.35                 0.07                          0   
2           8.90                 0.21                          0   
3          11.11                 0.17                          0   
4           6.92                 0.10                          0   

   cb_person_cred_hist_length  loan_status  
0                          14            0  
1                           2            0  
2                          10            0  
3                           5            0  
4                           3            0  
</pre></div>
</div>
</div>
</div>
<p>importing dagshub for logging ml model details</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">mlflow</span> <span class="n">dagshub</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: mlflow in c:\users\hp\anaconda3\lib\site-packages (2.19.0)
Requirement already satisfied: dagshub in c:\users\hp\anaconda3\lib\site-packages (0.3.47)
Requirement already satisfied: mlflow-skinny==2.19.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (2.19.0)
Requirement already satisfied: Flask&lt;4 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.0.3)
Requirement already satisfied: Jinja2&lt;4,&gt;=3.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.1.4)
Requirement already satisfied: alembic!=1.10.0,&lt;2 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (1.14.0)
Requirement already satisfied: docker&lt;8,&gt;=4.0.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (7.1.0)
Requirement already satisfied: graphene&lt;4 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.4.3)
Requirement already satisfied: markdown&lt;4,&gt;=3.3 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.4.1)
Requirement already satisfied: matplotlib&lt;4 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.8.4)
Requirement already satisfied: numpy&lt;3 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (1.26.4)
Requirement already satisfied: pandas&lt;3 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (2.2.2)
Requirement already satisfied: pyarrow&lt;19,&gt;=4.0.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (14.0.2)
Requirement already satisfied: scikit-learn&lt;2 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (1.4.2)
Requirement already satisfied: scipy&lt;2 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (1.13.1)
Requirement already satisfied: sqlalchemy&lt;3,&gt;=1.4.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (2.0.30)
Requirement already satisfied: waitress&lt;4 in c:\users\hp\anaconda3\lib\site-packages (from mlflow) (3.0.2)
Requirement already satisfied: cachetools&lt;6,&gt;=5.0.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (5.3.3)
Requirement already satisfied: click&lt;9,&gt;=7.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (8.1.7)
Requirement already satisfied: cloudpickle&lt;4 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.2.1)
Requirement already satisfied: databricks-sdk&lt;1,&gt;=0.20.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.39.0)
Requirement already satisfied: gitpython&lt;4,&gt;=3.1.9 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (3.1.37)
Requirement already satisfied: importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (7.0.1)
Requirement already satisfied: opentelemetry-api&lt;3,&gt;=1.9.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: opentelemetry-sdk&lt;3,&gt;=1.9.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (1.29.0)
Requirement already satisfied: packaging&lt;25 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (23.2)
Requirement already satisfied: protobuf&lt;6,&gt;=3.12.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (3.20.3)
Requirement already satisfied: pyyaml&lt;7,&gt;=5.1 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (6.0.1)
Requirement already satisfied: requests&lt;3,&gt;=2.17.3 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (2.32.2)
Requirement already satisfied: sqlparse&lt;1,&gt;=0.4.0 in c:\users\hp\anaconda3\lib\site-packages (from mlflow-skinny==2.19.0-&gt;mlflow) (0.5.3)
Requirement already satisfied: appdirs&gt;=1.4.4 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (1.4.4)
Requirement already satisfied: httpx&gt;=0.23.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (0.27.0)
Requirement already satisfied: rich&gt;=13.1.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (13.3.5)
Requirement already satisfied: dacite~=1.6.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (1.6.0)
Requirement already satisfied: tenacity&gt;=8.2.2 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (8.2.2)
Requirement already satisfied: gql[requests] in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (3.5.0)
Requirement already satisfied: dataclasses-json in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (0.6.7)
Requirement already satisfied: treelib&gt;=1.6.4 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (1.7.0)
Requirement already satisfied: pathvalidate&gt;=3.0.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (3.2.1)
Requirement already satisfied: python-dateutil in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (2.9.0.post0)
Requirement already satisfied: boto3 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (1.35.81)
Requirement already satisfied: dagshub-annotation-converter&gt;=0.1.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub) (0.1.2)
Requirement already satisfied: Mako in c:\users\hp\anaconda3\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (1.3.8)
Requirement already satisfied: typing-extensions&gt;=4 in c:\users\hp\anaconda3\lib\site-packages (from alembic!=1.10.0,&lt;2-&gt;mlflow) (4.11.0)
Requirement already satisfied: colorama in c:\users\hp\anaconda3\lib\site-packages (from click&lt;9,&gt;=7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.6)
Requirement already satisfied: lxml in c:\users\hp\anaconda3\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (5.2.1)
Requirement already satisfied: pillow in c:\users\hp\anaconda3\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (10.3.0)
Requirement already satisfied: pydantic&gt;=2.0.0 in c:\users\hp\anaconda3\lib\site-packages (from dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.5.3)
Requirement already satisfied: pywin32&gt;=304 in c:\users\hp\anaconda3\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (305.1)
Requirement already satisfied: urllib3&gt;=1.26.0 in c:\users\hp\anaconda3\lib\site-packages (from docker&lt;8,&gt;=4.0.0-&gt;mlflow) (2.2.2)
Requirement already satisfied: Werkzeug&gt;=3.0.0 in c:\users\hp\anaconda3\lib\site-packages (from Flask&lt;4-&gt;mlflow) (3.0.3)
Requirement already satisfied: itsdangerous&gt;=2.1.2 in c:\users\hp\anaconda3\lib\site-packages (from Flask&lt;4-&gt;mlflow) (2.2.0)
Requirement already satisfied: blinker&gt;=1.6.2 in c:\users\hp\anaconda3\lib\site-packages (from Flask&lt;4-&gt;mlflow) (1.6.2)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in c:\users\hp\anaconda3\lib\site-packages (from gitpython&lt;4,&gt;=3.1.9-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.0.7)
Requirement already satisfied: graphql-core&lt;3.3,&gt;=3.1 in c:\users\hp\anaconda3\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.5)
Requirement already satisfied: graphql-relay&lt;3.3,&gt;=3.1 in c:\users\hp\anaconda3\lib\site-packages (from graphene&lt;4-&gt;mlflow) (3.2.0)
Requirement already satisfied: anyio in c:\users\hp\anaconda3\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (4.2.0)
Requirement already satisfied: certifi in c:\users\hp\anaconda3\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (2024.7.4)
Requirement already satisfied: httpcore==1.* in c:\users\hp\anaconda3\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.0.2)
Requirement already satisfied: idna in c:\users\hp\anaconda3\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (3.7)
Requirement already satisfied: sniffio in c:\users\hp\anaconda3\lib\site-packages (from httpx&gt;=0.23.0-&gt;dagshub) (1.3.0)
Requirement already satisfied: h11&lt;0.15,&gt;=0.13 in c:\users\hp\anaconda3\lib\site-packages (from httpcore==1.*-&gt;httpx&gt;=0.23.0-&gt;dagshub) (0.14.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in c:\users\hp\anaconda3\lib\site-packages (from Jinja2&lt;4,&gt;=3.0-&gt;mlflow) (2.1.3)
Requirement already satisfied: contourpy&gt;=1.0.1 in c:\users\hp\anaconda3\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.2.0)
Requirement already satisfied: cycler&gt;=0.10 in c:\users\hp\anaconda3\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (0.11.0)
Requirement already satisfied: fonttools&gt;=4.22.0 in c:\users\hp\anaconda3\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (4.51.0)
Requirement already satisfied: kiwisolver&gt;=1.3.1 in c:\users\hp\anaconda3\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (1.4.4)
Requirement already satisfied: pyparsing&gt;=2.3.1 in c:\users\hp\anaconda3\lib\site-packages (from matplotlib&lt;4-&gt;mlflow) (3.0.9)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\hp\anaconda3\lib\site-packages (from pandas&lt;3-&gt;mlflow) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\hp\anaconda3\lib\site-packages (from pandas&lt;3-&gt;mlflow) (2023.3)
Requirement already satisfied: six&gt;=1.5 in c:\users\hp\anaconda3\lib\site-packages (from python-dateutil-&gt;dagshub) (1.16.0)
Requirement already satisfied: markdown-it-py&lt;3.0.0,&gt;=2.2.0 in c:\users\hp\anaconda3\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.2.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in c:\users\hp\anaconda3\lib\site-packages (from rich&gt;=13.1.0-&gt;dagshub) (2.15.1)
Requirement already satisfied: joblib&gt;=1.2.0 in c:\users\hp\anaconda3\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (1.4.2)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in c:\users\hp\anaconda3\lib\site-packages (from scikit-learn&lt;2-&gt;mlflow) (2.2.0)
Requirement already satisfied: greenlet!=0.4.17 in c:\users\hp\anaconda3\lib\site-packages (from sqlalchemy&lt;3,&gt;=1.4.0-&gt;mlflow) (3.0.1)
Requirement already satisfied: botocore&lt;1.36.0,&gt;=1.35.81 in c:\users\hp\anaconda3\lib\site-packages (from boto3-&gt;dagshub) (1.35.81)
Requirement already satisfied: jmespath&lt;2.0.0,&gt;=0.7.1 in c:\users\hp\anaconda3\lib\site-packages (from boto3-&gt;dagshub) (1.0.1)
Requirement already satisfied: s3transfer&lt;0.11.0,&gt;=0.10.0 in c:\users\hp\anaconda3\lib\site-packages (from boto3-&gt;dagshub) (0.10.4)
Requirement already satisfied: marshmallow&lt;4.0.0,&gt;=3.18.0 in c:\users\hp\anaconda3\lib\site-packages (from dataclasses-json-&gt;dagshub) (3.23.1)
Requirement already satisfied: typing-inspect&lt;1,&gt;=0.4.0 in c:\users\hp\anaconda3\lib\site-packages (from dataclasses-json-&gt;dagshub) (0.9.0)
Requirement already satisfied: yarl&lt;2.0,&gt;=1.6 in c:\users\hp\anaconda3\lib\site-packages (from gql[requests]-&gt;dagshub) (1.9.3)
Requirement already satisfied: backoff&lt;3.0,&gt;=1.11.1 in c:\users\hp\anaconda3\lib\site-packages (from gql[requests]-&gt;dagshub) (2.2.1)
Requirement already satisfied: requests-toolbelt&lt;2,&gt;=1.0.0 in c:\users\hp\anaconda3\lib\site-packages (from gql[requests]-&gt;dagshub) (1.0.0)
Requirement already satisfied: google-auth~=2.0 in c:\users\hp\anaconda3\lib\site-packages (from databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.37.0)
Requirement already satisfied: smmap&lt;5,&gt;=3.0.1 in c:\users\hp\anaconda3\lib\site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;gitpython&lt;4,&gt;=3.1.9-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.0.0)
Requirement already satisfied: zipp&gt;=0.5 in c:\users\hp\anaconda3\lib\site-packages (from importlib_metadata!=4.7.0,&lt;9,&gt;=3.7.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (3.17.0)
Requirement already satisfied: mdurl~=0.1 in c:\users\hp\anaconda3\lib\site-packages (from markdown-it-py&lt;3.0.0,&gt;=2.2.0-&gt;rich&gt;=13.1.0-&gt;dagshub) (0.1.0)
Requirement already satisfied: deprecated&gt;=1.2.6 in c:\users\hp\anaconda3\lib\site-packages (from opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.2.15)
Requirement already satisfied: opentelemetry-semantic-conventions==0.50b0 in c:\users\hp\anaconda3\lib\site-packages (from opentelemetry-sdk&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.50b0)
Requirement already satisfied: annotated-types&gt;=0.4.0 in c:\users\hp\anaconda3\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (0.6.0)
Requirement already satisfied: pydantic-core==2.14.6 in c:\users\hp\anaconda3\lib\site-packages (from pydantic&gt;=2.0.0-&gt;dagshub-annotation-converter&gt;=0.1.0-&gt;dagshub) (2.14.6)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\hp\anaconda3\lib\site-packages (from requests&lt;3,&gt;=2.17.3-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (2.0.4)
Requirement already satisfied: mypy-extensions&gt;=0.3.0 in c:\users\hp\anaconda3\lib\site-packages (from typing-inspect&lt;1,&gt;=0.4.0-&gt;dataclasses-json-&gt;dagshub) (1.0.0)
Requirement already satisfied: multidict&gt;=4.0 in c:\users\hp\anaconda3\lib\site-packages (from yarl&lt;2.0,&gt;=1.6-&gt;gql[requests]-&gt;dagshub) (6.0.4)
Requirement already satisfied: wrapt&lt;2,&gt;=1.10 in c:\users\hp\anaconda3\lib\site-packages (from deprecated&gt;=1.2.6-&gt;opentelemetry-api&lt;3,&gt;=1.9.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (1.14.1)
Requirement already satisfied: pyasn1-modules&gt;=0.2.1 in c:\users\hp\anaconda3\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.2.8)
Requirement already satisfied: rsa&lt;5,&gt;=3.1.4 in c:\users\hp\anaconda3\lib\site-packages (from google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (4.9)
Requirement already satisfied: pyasn1&lt;0.5.0,&gt;=0.4.6 in c:\users\hp\anaconda3\lib\site-packages (from pyasn1-modules&gt;=0.2.1-&gt;google-auth~=2.0-&gt;databricks-sdk&lt;1,&gt;=0.20.0-&gt;mlflow-skinny==2.19.0-&gt;mlflow) (0.4.8)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">initiating</span> <span class="n">the</span> <span class="n">repository</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">dagshub</span>

<span class="c1"># Initialize DagsHub</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;nithinyanna3&#39;</span><span class="p">,</span> <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;my-first-repo&#39;</span><span class="p">,</span> <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Accessing as nithinyanna3
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"nithinyanna3/my-first-repo"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository nithinyanna3/my-first-repo initialized!
</pre>
</div></div>
</div>
<p>performing logistic regression with pipeline and data transforming</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span><span class="p">,</span> <span class="n">accuracy_score</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Assuming secondupdate and test_data are already loaded DataFrames</span>
<span class="c1"># Training data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Use the `secondupdate` DataFrame</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Testing data</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Separate numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">()),</span>  <span class="c1"># Standardize numerical data</span>
    <span class="p">(</span><span class="s2">&quot;minmax&quot;</span><span class="p">,</span> <span class="n">MinMaxScaler</span><span class="p">())</span>     <span class="c1"># Normalize between 0 and 1</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>  <span class="c1"># One-hot encoding for categorical data</span>
<span class="p">])</span>

<span class="c1"># Combine preprocessors</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Full pipeline with logistic regression</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">solver</span><span class="o">=</span><span class="s2">&quot;liblinear&quot;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">))</span>
<span class="p">])</span>

<span class="c1"># Hyperparameter tuning with GridSearchCV</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;classifier__C&quot;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">100</span><span class="p">],</span>  <span class="c1"># Regularization strength</span>
    <span class="s2">&quot;classifier__penalty&quot;</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;l1&quot;</span><span class="p">,</span> <span class="s2">&quot;l2&quot;</span><span class="p">]</span>        <span class="c1"># L1/L2 regularization</span>
<span class="p">}</span>

<span class="c1"># Stratified K-Fold Cross Validation</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Grid search for best parameters</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;f1&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Best parameters and results</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>
<span class="n">cv_results</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span>
<span class="n">mean_f1</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_score_</span>
<span class="n">std_f1</span> <span class="o">=</span> <span class="n">cv_results</span><span class="p">[</span><span class="s2">&quot;std_test_score&quot;</span><span class="p">][</span><span class="n">grid_search</span><span class="o">.</span><span class="n">best_index_</span><span class="p">]</span>

<span class="c1"># Predictions and metrics on the test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Evaluate Accuracy</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># F1-score</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

<span class="c1"># Confusion Matrix</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Best Parameters:&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Standard Deviation of F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy on Test Set:&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 Score on Test Set:&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix (TN, FP, FN, TP):&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>

<span class="c1"># Testing on first 5 rows of test_data</span>
<span class="n">test_predictions</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions for the first 5 rows of test_data:&quot;</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>

<span class="c1"># Save the model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;logistic_regression_model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Log experiment in MLflow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_C&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__C&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_penalty&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__penalty&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cv_splits&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_cv_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_cv_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    
    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;logistic_regression_model&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save and log confusion matrix</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment successfully logged to MLflow!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Best Parameters: {&#39;classifier__C&#39;: 100, &#39;classifier__penalty&#39;: &#39;l2&#39;}
F1 Score (CV): 0.4728985183873246
Standard Deviation of F1 Score (CV): 0.019636412673607086
Accuracy on Test Set: 0.8857216672407854
F1 Score on Test Set: 0.4736215787385958
Confusion Matrix (TN, FP, FN, TP): 9688 278 1049 597
Predictions for the first 5 rows of test_data: [1 0 1 0 0]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 14:20:58 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Experiment successfully logged to MLflow!
</pre></div>
</div>
<img alt="../_images/6e4a531906a1a20f656aa05978761fb5ec5f5d791d62e6dfa7f3beec102bd11d.png" src="../_images/6e4a531906a1a20f656aa05978761fb5ec5f5d791d62e6dfa7f3beec102bd11d.png" />
</div>
</div>
<p>performing ridge classifier with pipeline and data transforming</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Assuming `secondupdate` and `test_data` DataFrames are already loaded</span>
<span class="c1"># Training data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Use the `secondupdate` DataFrame</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Testing data</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Separate numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>  <span class="c1"># Standardize numerical data</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>  <span class="c1"># One-hot encoding for categorical data</span>
<span class="p">])</span>

<span class="c1"># Combine preprocessors</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define the Ridge Classifier model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RidgeClassifier</span><span class="p">()</span>

<span class="c1"># Hyperparameter tuning with GridSearchCV</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__alpha&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.1</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Regularization strength</span>
    <span class="s1">&#39;classifier__solver&#39;</span><span class="p">:</span> <span class="p">[</span><span class="s1">&#39;auto&#39;</span><span class="p">,</span> <span class="s1">&#39;svd&#39;</span><span class="p">,</span> <span class="s1">&#39;cholesky&#39;</span><span class="p">,</span> <span class="s1">&#39;lsqr&#39;</span><span class="p">,</span> <span class="s1">&#39;sparse_cg&#39;</span><span class="p">]</span>  <span class="c1"># Solvers for Ridge</span>
<span class="p">}</span>

<span class="c1"># Full pipeline with model</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Stratified K-Fold Cross Validation</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Grid search for best parameters</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Best model and parameters</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># Predict on test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Calculate metrics</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">])</span>
<span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;std_test_score&quot;</span><span class="p">])</span>

<span class="c1"># Confusion matrix</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Test first 5 rows of `test_data`</span>
<span class="n">test_predictions</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Predictions for the first 5 rows of test_data:&quot;</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>

<span class="c1"># Save the model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;ridge_classifier_model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Start MLflow Run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_alpha&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__alpha&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_solver&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__solver&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cv_splits&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_cv_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_cv_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    
    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;ridge_classifier_model&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save and log confusion matrix</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    
    <span class="c1"># Print metrics to notebook</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy:&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 Score (Weighted):&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Std F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Positives (TP):&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Negatives (FN):&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Positives (FP):&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Negatives (TN):&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment successfully logged to MLflow!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions for the first 5 rows of test_data: [0 0 0 0 0]
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 13:22:08 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Accuracy: 0.880985187736824
F1 Score (Weighted): 0.8508153925100107
Mean F1 Score (CV): 0.8808867768311529
Std F1 Score (CV): 1.6995211594251085e-05
Confusion Matrix:
[[9868   98]
 [1284  362]]
True Positives (TP): 362
False Negatives (FN): 1284
False Positives (FP): 98
True Negatives (TN): 9868
Experiment successfully logged to MLflow!
 View run mysterious-goat-182 at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/ab78a0a385734998a0e00c5c5ba607f1
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<img alt="../_images/d82e055bdac09e0311b8cdce27658e153623dc96d3a7bae07943b60661bcbc92.png" src="../_images/d82e055bdac09e0311b8cdce27658e153623dc96d3a7bae07943b60661bcbc92.png" />
</div>
</div>
<p>performing XGBClassifier with pipeline and data transforming</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Assuming `secondupdate` and `test_data` DataFrames are already loaded</span>
<span class="c1"># Training data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Use the `secondupdate` DataFrame</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Testing data</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Separate numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>  <span class="c1"># Standardize numerical data</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>  <span class="c1"># One-hot encoding for categorical data</span>
<span class="p">])</span>

<span class="c1"># Combine preprocessors</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define the XGB Classifier model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">)</span>

<span class="c1"># Hyperparameter tuning with GridSearchCV</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>  <span class="c1"># Number of trees in the forest</span>
    <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Maximum depth of the tree</span>
    <span class="s1">&#39;classifier__learning_rate&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.01</span><span class="p">,</span> <span class="mf">0.1</span><span class="p">,</span> <span class="mf">0.2</span><span class="p">],</span>  <span class="c1"># Learning rate</span>
    <span class="s1">&#39;classifier__subsample&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">],</span>  <span class="c1"># Fraction of samples used for fitting</span>
    <span class="s1">&#39;classifier__colsample_bytree&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mf">0.8</span><span class="p">,</span> <span class="mf">1.0</span><span class="p">]</span>  <span class="c1"># Fraction of features used for each tree</span>
<span class="p">}</span>

<span class="c1"># Full pipeline with model</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Stratified K-Fold Cross Validation</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Grid search for best parameters</span>
<span class="kn">import</span> <span class="nn">time</span>

<span class="c1"># Timer starts</span>
<span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting GridSearchCV...&quot;</span><span class="p">)</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span>
    <span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span>
    <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span>
    <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span>
    <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span>
    <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span>  <span class="c1"># Verbosity level to show progress</span>
<span class="p">)</span>

<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Timer ends</span>
<span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
<span class="n">execution_time</span> <span class="o">=</span> <span class="n">end_time</span> <span class="o">-</span> <span class="n">start_time</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">GridSearchCV completed in </span><span class="si">{</span><span class="n">execution_time</span><span class="si">:</span><span class="s2">.2f</span><span class="si">}</span><span class="s2"> seconds.&quot;</span><span class="p">)</span>

<span class="c1"># Best model and parameters</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># Predict on test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Calculate metrics</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">])</span>
<span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;std_test_score&quot;</span><span class="p">])</span>

<span class="c1"># Confusion matrix</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Test first 5 rows of `test_data`</span>
<span class="n">test_predictions</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions for the first 5 rows of test_data:&quot;</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>

<span class="c1"># Save the model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;xgb_classifier_model.pkl&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model saved as &#39;xgb_classifier_model.pkl&#39;.&quot;</span><span class="p">)</span>

<span class="c1"># Start MLflow Run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_n_estimators&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__n_estimators&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_max_depth&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__max_depth&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_learning_rate&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__learning_rate&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_subsample&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__subsample&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_colsample_bytree&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__colsample_bytree&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cv_splits&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_cv_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_cv_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    
    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;xgb_classifier_model&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save and log confusion matrix</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    
    <span class="c1"># Print metrics to notebook</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy:&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 Score (Weighted):&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Std F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Positives (TP):&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Negatives (FN):&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Positives (FP):&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Negatives (TN):&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment successfully logged to MLflow!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting GridSearchCV...
Fitting 10 folds for each of 108 candidates, totalling 1080 fits
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\HP\anaconda3\Lib\site-packages\xgboost\core.py:158: UserWarning: [13:31:42] WARNING: C:\buildkite-agent\builds\buildkite-windows-cpu-autoscaling-group-i-0c55ff5f71b100e98-1\xgboost\xgboost-ci-windows\src\learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.

  warnings.warn(smsg, UserWarning)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>GridSearchCV completed in 161.41 seconds.

Predictions for the first 5 rows of test_data: [1 0 1 0 0]
Model saved as &#39;xgb_classifier_model.pkl&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 13:31:53 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Metrics:
Accuracy: 0.9173269032035825
F1 Score (Weighted): 0.9139787570137752
Mean F1 Score (CV): 0.906618580447282
Std F1 Score (CV): 0.0016429811984086614
Confusion Matrix:
[[9629  337]
 [ 623 1023]]
True Positives (TP): 1023
False Negatives (FN): 623
False Positives (FP): 337
True Negatives (TN): 9629
Experiment successfully logged to MLflow!
 View run marvelous-crab-821 at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/07275b51f40a43719b58c994bef13fd2
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<img alt="../_images/b985da3dcde8acc24da664004d558f91f94f98cfc6078c22fef17856928a63ce.png" src="../_images/b985da3dcde8acc24da664004d558f91f94f98cfc6078c22fef17856928a63ce.png" />
</div>
</div>
<p>performing Random forest with pipeline and data transforming</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span><span class="p">,</span> <span class="n">StratifiedKFold</span><span class="p">,</span> <span class="n">GridSearchCV</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Assuming `secondupdate` and `test_data` DataFrames are already loaded</span>
<span class="c1"># Training data</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>  <span class="c1"># Use the `secondupdate` DataFrame</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Testing data</span>
<span class="n">test_features</span> <span class="o">=</span> <span class="n">test_data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Separate numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing steps</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>  <span class="c1"># Standardize numerical data</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>  <span class="c1"># One-hot encoding for categorical data</span>
<span class="p">])</span>

<span class="c1"># Combine preprocessors</span>
<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span>
    <span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
        <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
        <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
    <span class="p">]</span>
<span class="p">)</span>

<span class="c1"># Define the Random Forest Classifier model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Hyperparameter tuning with GridSearchCV</span>
<span class="n">param_grid</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;classifier__n_estimators&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">50</span><span class="p">,</span> <span class="mi">100</span><span class="p">,</span> <span class="mi">200</span><span class="p">],</span>  <span class="c1"># Number of trees in the forest</span>
    <span class="s1">&#39;classifier__max_depth&#39;</span><span class="p">:</span> <span class="p">[</span><span class="kc">None</span><span class="p">,</span> <span class="mi">10</span><span class="p">,</span> <span class="mi">20</span><span class="p">],</span>  <span class="c1"># Maximum depth of the tree</span>
    <span class="s1">&#39;classifier__min_samples_split&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">2</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">10</span><span class="p">],</span>  <span class="c1"># Minimum number of samples required to split a node</span>
    <span class="s1">&#39;classifier__min_samples_leaf&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">4</span><span class="p">]</span>  <span class="c1"># Minimum number of samples required to be at a leaf node</span>
<span class="p">}</span>

<span class="c1"># Full pipeline with model</span>
<span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Stratified K-Fold Cross Validation</span>
<span class="n">cv</span> <span class="o">=</span> <span class="n">StratifiedKFold</span><span class="p">(</span><span class="n">n_splits</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">shuffle</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># Grid search for best parameters</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Starting GridSearchCV...&quot;</span><span class="p">)</span>
<span class="n">grid_search</span> <span class="o">=</span> <span class="n">GridSearchCV</span><span class="p">(</span><span class="n">estimator</span><span class="o">=</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">param_grid</span><span class="o">=</span><span class="n">param_grid</span><span class="p">,</span> <span class="n">cv</span><span class="o">=</span><span class="n">cv</span><span class="p">,</span> <span class="n">scoring</span><span class="o">=</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">n_jobs</span><span class="o">=-</span><span class="mi">1</span><span class="p">,</span> <span class="n">verbose</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span>
<span class="n">grid_search</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Best model and parameters</span>
<span class="n">best_model</span> <span class="o">=</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_estimator_</span>

<span class="c1"># Predict on test set</span>
<span class="n">y_pred</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Calculate metrics</span>
<span class="n">accuracy</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
<span class="n">mean_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">mean</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;mean_test_score&quot;</span><span class="p">])</span>
<span class="n">std_f1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">std</span><span class="p">(</span><span class="n">grid_search</span><span class="o">.</span><span class="n">cv_results_</span><span class="p">[</span><span class="s2">&quot;std_test_score&quot;</span><span class="p">])</span>

<span class="c1"># Confusion matrix</span>
<span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
<span class="n">tn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">tp</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>

<span class="c1"># Test first 5 rows of `test_data`</span>
<span class="n">test_predictions</span> <span class="o">=</span> <span class="n">best_model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_features</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions for the first 5 rows of test_data:&quot;</span><span class="p">,</span> <span class="n">test_predictions</span><span class="p">)</span>

<span class="c1"># Save the model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;random_forest_classifier_model.pkl&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model saved as &#39;random_forest_classifier_model.pkl&#39;.&quot;</span><span class="p">)</span>

<span class="c1"># Start MLflow Run</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="c1"># Log parameters</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_n_estimators&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__n_estimators&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_max_depth&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__max_depth&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_min_samples_split&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__min_samples_split&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;best_min_samples_leaf&quot;</span><span class="p">,</span> <span class="n">grid_search</span><span class="o">.</span><span class="n">best_params_</span><span class="p">[</span><span class="s2">&quot;classifier__min_samples_leaf&quot;</span><span class="p">])</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;cv_splits&quot;</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span>
    
    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;mean_cv_f1&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;std_cv_f1&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    
    <span class="c1"># Log model</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">best_model</span><span class="p">,</span> <span class="s2">&quot;random_forest_classifier_model&quot;</span><span class="p">)</span>
    
    <span class="c1"># Save and log confusion matrix</span>
    <span class="n">fig</span><span class="p">,</span> <span class="n">ax</span> <span class="o">=</span> <span class="n">plt</span><span class="o">.</span><span class="n">subplots</span><span class="p">()</span>
    <span class="n">ax</span><span class="o">.</span><span class="n">matshow</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">),</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">np</span><span class="o">.</span><span class="n">ndenumerate</span><span class="p">(</span><span class="n">cm</span><span class="p">):</span>
        <span class="n">ax</span><span class="o">.</span><span class="n">text</span><span class="p">(</span><span class="n">j</span><span class="p">,</span> <span class="n">i</span><span class="p">,</span> <span class="n">val</span><span class="p">,</span> <span class="n">ha</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">,</span> <span class="n">va</span><span class="o">=</span><span class="s2">&quot;center&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix&quot;</span><span class="p">)</span>
    <span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_artifact</span><span class="p">(</span><span class="s2">&quot;confusion_matrix.png&quot;</span><span class="p">)</span>
    
    <span class="c1"># Print metrics to notebook</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Accuracy:&quot;</span><span class="p">,</span> <span class="n">accuracy</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;F1 Score (Weighted):&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Mean F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">mean_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Std F1 Score (CV):&quot;</span><span class="p">,</span> <span class="n">std_f1</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Confusion Matrix:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">cm</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Positives (TP):&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Negatives (FN):&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;False Positives (FP):&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;True Negatives (TN):&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Experiment successfully logged to MLflow!&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Starting GridSearchCV...
Fitting 10 folds for each of 81 candidates, totalling 810 fits

Predictions for the first 5 rows of test_data: [1 0 1 0 0]
Model saved as &#39;random_forest_classifier_model.pkl&#39;.
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 13:49:18 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Metrics:
Accuracy: 0.9099207716155701
F1 Score (Weighted): 0.9056951580786216
Mean F1 Score (CV): 0.9126145944244894
Std F1 Score (CV): 0.0003477845852202995
Confusion Matrix:
[[9606  360]
 [ 686  960]]
True Positives (TP): 960
False Negatives (FN): 686
False Positives (FP): 360
True Negatives (TN): 9606
Experiment successfully logged to MLflow!
 View run flawless-midge-434 at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/e68d2fa0504f4a009868e8353f4dd6d7
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0
</pre></div>
</div>
<img alt="../_images/b180f5fa4c789324864df70d5e070b6cd243dbce08c33ec7de933c7fc24c4881.png" src="../_images/b180f5fa4c789324864df70d5e070b6cd243dbce08c33ec7de933c7fc24c4881.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">dagshub</span>

<span class="c1"># Initialize DagsHub</span>
<span class="n">dagshub</span><span class="o">.</span><span class="n">init</span><span class="p">(</span><span class="n">repo_owner</span><span class="o">=</span><span class="s1">&#39;nithinyanna3&#39;</span><span class="p">,</span> <span class="n">repo_name</span><span class="o">=</span><span class="s1">&#39;my-first-repo&#39;</span><span class="p">,</span> <span class="n">mlflow</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Initialized MLflow to track repo <span style="color: #008000; text-decoration-color: #008000">"nithinyanna3/my-first-repo"</span>
</pre>
</div><div class="output text_html"><pre style="white-space:pre;overflow-x:auto;line-height:normal;font-family:Menlo,'DejaVu Sans Mono',consolas,'Courier New',monospace">Repository nithinyanna3/my-first-repo initialized!
</pre>
</div></div>
</div>
<p>applying column transformations and performing all the 4 models and logging into dagshub</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">tempfile</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Feature Engineering Function</span>
<span class="k">def</span> <span class="nf">feature_engineering</span><span class="p">(</span><span class="n">df</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    
    <span class="c1"># Derived features</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_to_income_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_income&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;income_to_age_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_income&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;credit_age_ratio&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s1">&#39;cb_person_cred_hist_length&#39;</span><span class="p">]</span> <span class="o">/</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">]</span> <span class="o">+</span> <span class="mf">1e-5</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;high_loan&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">]</span> <span class="o">&gt;</span> <span class="mi">10000</span><span class="p">)</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_loan_amnt&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;loan_amnt&#39;</span><span class="p">])</span>
    <span class="n">df</span><span class="p">[</span><span class="s1">&#39;log_income&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">log1p</span><span class="p">(</span><span class="n">df</span><span class="p">[</span><span class="s1">&#39;person_income&#39;</span><span class="p">])</span>
    
    <span class="c1"># Return modified DataFrame and list of new features</span>
    <span class="n">new_features</span> <span class="o">=</span> <span class="p">[</span>
        <span class="s1">&#39;loan_to_income_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;income_to_age_ratio&#39;</span><span class="p">,</span> <span class="s1">&#39;credit_age_ratio&#39;</span><span class="p">,</span>
        <span class="s1">&#39;high_loan&#39;</span><span class="p">,</span> <span class="s1">&#39;log_loan_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;log_income&#39;</span>
    <span class="p">]</span>
    <span class="k">return</span> <span class="n">df</span><span class="p">,</span> <span class="n">new_features</span>

<span class="c1"># Process the training data (secondupdate)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing training data...&quot;</span><span class="p">)</span>
<span class="n">thirdupdate</span><span class="p">,</span> <span class="n">new_features</span> <span class="o">=</span> <span class="n">feature_engineering</span><span class="p">(</span><span class="n">secondupdate</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Training data processed. Shape:&quot;</span><span class="p">,</span> <span class="n">thirdupdate</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Process the testing data (test_data)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Processing test data...&quot;</span><span class="p">)</span>
<span class="n">test_data_fe</span><span class="p">,</span> <span class="n">_</span> <span class="o">=</span> <span class="n">feature_engineering</span><span class="p">(</span><span class="n">test_data</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Test data processed. Shape:&quot;</span><span class="p">,</span> <span class="n">test_data_fe</span><span class="o">.</span><span class="n">shape</span><span class="p">)</span>

<span class="c1"># Save feature-engineered datasets (optional)</span>
<span class="n">thirdupdate</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;thirdupdate.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">test_data_fe</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="s2">&quot;test_data_fe.csv&quot;</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Prepare training and target variables</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">thirdupdate</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Independent variables</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">thirdupdate</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>  <span class="c1"># Target variable</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Identify numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing Pipelines</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="c1"># Define models</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Set the MLflow tracking URI and experiment name</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/nithinyanna3/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Change path if needed</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>  <span class="c1"># Set experiment name</span>

<span class="c1"># Train and Log Models</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_FeatureEngineering&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Full pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">])</span>
        
        <span class="c1"># Train the model</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Predict</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        
        <span class="c1"># Print metrics</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion Matrix:</span><span class="se">\n</span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Extract confusion matrix values</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="c1"># Print confusion matrix values</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positives (TP): </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Negatives (TN): </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Positives (FP): </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Negatives (FN): </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Visualize confusion matrix</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Confusion Matrix - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c1"># Save the model using joblib</span>
        <span class="n">model_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_pipeline.joblib&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">model_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved as </span><span class="si">{</span><span class="n">model_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log metrics and model to MLflow</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_model&quot;</span><span class="p">)</span>
        
        <span class="c1"># Predict for the first 5 rows of test data</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions on first 5 rows of test_data_fe using </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_data_fe</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All models have been trained, logged, and saved successfully.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Processing training data...
Training data processed. Shape: (58058, 16)
Processing test data...
Test data processed. Shape: (39098, 15)

Training LogisticRegression...
Model: LogisticRegression
Accuracy: 0.8880
F1 Score: 0.8731
Confusion Matrix:
[[9697  269]
 [1032  614]]
True Positives (TP): 9697
True Negatives (TN): 614
False Positives (FP): 1032
False Negatives (FN): 269
</pre></div>
</div>
<img alt="../_images/32a2712faa57af7f483a8e25beff9b50989903764273c06fa1ffc4fb6da50111.png" src="../_images/32a2712faa57af7f483a8e25beff9b50989903764273c06fa1ffc4fb6da50111.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as LogisticRegression_pipeline.joblib
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 14:29:30 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions on first 5 rows of test_data_fe using LogisticRegression:
[1 0 1 0 0]
 View run LogisticRegression_FeatureEngineering at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/8b49ef5c002744b4b5664f42119eddf3
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training RidgeClassifier...
Model: RidgeClassifier
Accuracy: 0.8826
F1 Score: 0.8563
Confusion Matrix:
[[9834  132]
 [1231  415]]
True Positives (TP): 9834
True Negatives (TN): 415
False Positives (FP): 1231
False Negatives (FN): 132
</pre></div>
</div>
<img alt="../_images/48580b131c78f59e3fd54bdf00a46e90cf2a3ae2c1483458d47383d64d8abb04.png" src="../_images/48580b131c78f59e3fd54bdf00a46e90cf2a3ae2c1483458d47383d64d8abb04.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as RidgeClassifier_pipeline.joblib
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 14:29:42 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions on first 5 rows of test_data_fe using RidgeClassifier:
[1 0 0 0 0]
 View run RidgeClassifier_FeatureEngineering at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/a065305fdb5d44968434ebe6c4e56f9d
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training RandomForestClassifier...
Model: RandomForestClassifier
Accuracy: 0.9114
F1 Score: 0.9073
Confusion Matrix:
[[9613  353]
 [ 676  970]]
True Positives (TP): 9613
True Negatives (TN): 970
False Positives (FP): 676
False Negatives (FN): 353
</pre></div>
</div>
<img alt="../_images/fd7a21fc1096a52c9615d94af341661c52fcaf995d7abaec5e8e3c47f7c4f9f3.png" src="../_images/fd7a21fc1096a52c9615d94af341661c52fcaf995d7abaec5e8e3c47f7c4f9f3.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as RandomForestClassifier_pipeline.joblib
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 14:30:00 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions on first 5 rows of test_data_fe using RandomForestClassifier:
[1 0 1 0 0]
 View run RandomF-Fe at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/3b554e23bfd540e0a3a90200bf75c977
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training XGBClassifier...
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\HP\anaconda3\Lib\site-packages\xgboost\core.py:158: UserWarning: [14:30:32] WARNING: C:\buildkite-agent\builds\buildkite-windows-cpu-autoscaling-group-i-0c55ff5f71b100e98-1\xgboost\xgboost-ci-windows\src\learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.

  warnings.warn(smsg, UserWarning)
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model: XGBClassifier
Accuracy: 0.9179
F1 Score: 0.9150
Confusion Matrix:
[[9618  348]
 [ 605 1041]]
True Positives (TP): 9618
True Negatives (TN): 1041
False Positives (FP): 605
False Negatives (FN): 348
</pre></div>
</div>
<img alt="../_images/7499c3b078ff120b7e1f81d93418fb7d66d443514deafa29b1192041c60cebba.png" src="../_images/7499c3b078ff120b7e1f81d93418fb7d66d443514deafa29b1192041c60cebba.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as XGBClassifier_pipeline.joblib
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 14:30:38 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Predictions on first 5 rows of test_data_fe using XGBClassifier:
[1 0 1 0 0]
 View run XGBClassifier_FeatureEngineering at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/f7171e6b1e654dd3b58dcd1aedbd806a
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

All models have been trained, logged, and saved successfully.
</pre></div>
</div>
</div>
</div>
<p>applying variance threshold for the dataset and refining the dataset</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">from</span> <span class="nn">sklearn.feature_selection</span> <span class="kn">import</span> <span class="n">VarianceThreshold</span>

<span class="c1"># Assuming dfsecondupdate is already loaded in the environment</span>
<span class="c1"># dfsecondupdate = pd.read_csv(&quot;path_to_your_dfsecondupdate.csv&quot;)  # Uncomment and modify path as needed</span>

<span class="c1"># Create a copy of dfsecondupdate</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Separate target variable</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Features (excluding target)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>  <span class="c1"># Target variable</span>

<span class="c1"># Step 1: Apply Variance Threshold to remove low variance features</span>
<span class="n">variance_threshold</span> <span class="o">=</span> <span class="n">VarianceThreshold</span><span class="p">(</span><span class="n">threshold</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>  <span class="c1"># You can adjust the threshold as needed</span>

<span class="c1"># Apply VarianceThreshold to the features (X)</span>
<span class="n">X_var</span> <span class="o">=</span> <span class="n">variance_threshold</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Step 2: Identify the columns that were removed</span>
<span class="n">removed_columns</span> <span class="o">=</span> <span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="o">~</span><span class="n">variance_threshold</span><span class="o">.</span><span class="n">get_support</span><span class="p">()]</span>

<span class="c1"># Step 3: Convert the resulting array back to a DataFrame</span>
<span class="n">X_var_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">X_var</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="p">[</span><span class="n">variance_threshold</span><span class="o">.</span><span class="n">get_support</span><span class="p">()])</span>

<span class="c1"># Add the target variable back to the DataFrame</span>
<span class="n">X_var_df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y</span>

<span class="c1"># Step 4: Save the dataset with low-variance features removed</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;fourthupdate.csv&quot;</span>  <span class="c1"># Save in the environment</span>
<span class="n">X_var_df</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Print details</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Low-variance features removed: </span><span class="si">{</span><span class="s1">&#39;, &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">removed_columns</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Original dataset size: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;New dataset size after removing low-variance features: </span><span class="si">{</span><span class="n">X_var_df</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Print the columns in secondupdate and fourthupdate to see the difference</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns in secondupdate: </span><span class="si">{</span><span class="n">X</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Columns in fourthupdate: </span><span class="si">{</span><span class="n">X_var_df</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Low-variance features removed: loan_grade, loan_percent_income, cb_person_default_on_file
Original dataset size: (58058, 9)
New dataset size after removing low-variance features: (58058, 7)
Columns in secondupdate: [&#39;person_age&#39;, &#39;person_income&#39;, &#39;person_emp_length&#39;, &#39;loan_grade&#39;, &#39;loan_amnt&#39;, &#39;loan_int_rate&#39;, &#39;loan_percent_income&#39;, &#39;cb_person_default_on_file&#39;, &#39;cb_person_cred_hist_length&#39;]
Columns in fourthupdate: [&#39;person_age&#39;, &#39;person_income&#39;, &#39;person_emp_length&#39;, &#39;loan_amnt&#39;, &#39;loan_int_rate&#39;, &#39;cb_person_cred_hist_length&#39;, &#39;loan_status&#39;]
</pre></div>
</div>
</div>
</div>
<p>knowing the highly correlated variables</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="c1"># Load the dataset after applying Variance Threshold</span>
<span class="n">df_variance_threshold</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;fourthupdate.csv&quot;</span><span class="p">)</span>

<span class="c1"># Separate target variable</span>
<span class="n">X_var</span> <span class="o">=</span> <span class="n">df_variance_threshold</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Features (excluding target)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df_variance_threshold</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>  <span class="c1"># Target variable</span>

<span class="c1"># Calculate the correlation matrix for the features (X_var)</span>
<span class="n">correlation_matrix</span> <span class="o">=</span> <span class="n">X_var</span><span class="o">.</span><span class="n">corr</span><span class="p">()</span>

<span class="c1"># Print the correlation matrix</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix:&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span>

<span class="c1"># Extract high correlated variables with a threshold, e.g., |correlation| &gt; 0.7</span>
<span class="n">correlation_threshold</span> <span class="o">=</span> <span class="mf">0.7</span>
<span class="n">highly_correlated_vars</span> <span class="o">=</span> <span class="n">correlation_matrix</span><span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">)</span> <span class="o">&gt;</span> <span class="n">correlation_threshold</span><span class="p">]</span><span class="o">.</span><span class="n">stack</span><span class="p">()</span>
<span class="n">highly_correlated_vars</span> <span class="o">=</span> <span class="n">highly_correlated_vars</span><span class="p">[</span><span class="n">highly_correlated_vars</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">]</span>  <span class="c1"># Exclude self-correlation (correlation = 1)</span>

<span class="c1"># Print highly correlated variables</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;High correlated variables (threshold &gt; </span><span class="si">{</span><span class="n">correlation_threshold</span><span class="si">}</span><span class="s2">):&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">highly_correlated_vars</span><span class="p">)</span>

<span class="c1"># Plotting the heatmap for better visualization</span>
<span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">12</span><span class="p">,</span> <span class="mi">8</span><span class="p">))</span>
<span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">correlation_matrix</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;coolwarm&quot;</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;.2f&quot;</span><span class="p">,</span> <span class="n">linewidths</span><span class="o">=</span><span class="mf">0.5</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Correlation Matrix Heatmap&quot;</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Correlation Matrix:
                            person_age  person_income  person_emp_length  \
person_age                    1.000000       0.115944           0.116679   
person_income                 0.115944       1.000000           0.199807   
person_emp_length             0.116679       0.199807           1.000000   
loan_amnt                     0.047632       0.378064           0.092139   
loan_int_rate                 0.005217      -0.074235          -0.108780   
cb_person_cred_hist_length    0.871600       0.095027           0.101096   

                            loan_amnt  loan_int_rate  \
person_age                   0.047632       0.005217   
person_income                0.378064      -0.074235   
person_emp_length            0.092139      -0.108780   
loan_amnt                    1.000000       0.113635   
loan_int_rate                0.113635       1.000000   
cb_person_cred_hist_length   0.041843       0.003802   

                            cb_person_cred_hist_length  
person_age                                    0.871600  
person_income                                 0.095027  
person_emp_length                             0.101096  
loan_amnt                                     0.041843  
loan_int_rate                                 0.003802  
cb_person_cred_hist_length                    1.000000  
High correlated variables (threshold &gt; 0.7):
person_age                  cb_person_cred_hist_length    0.8716
cb_person_cred_hist_length  person_age                    0.8716
dtype: float64
</pre></div>
</div>
<img alt="../_images/5943ccce04c074c710be389fceaaf6312347634585adef60d0e548e9630c279e.png" src="../_images/5943ccce04c074c710be389fceaaf6312347634585adef60d0e548e9630c279e.png" />
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Assuming the file is saved in the environment as &#39;updatedtestdata.csv&#39;</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;updatedtestdata.csv&quot;</span>

<span class="c1"># Load the dataset</span>
<span class="n">df_updated_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_updated_test</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_age  person_income  person_emp_length  loan_grade  loan_amnt  \
0          23          69000                3.0         5.0      25000   
1          26          96000                6.0         2.0      10000   
2          26          30000                5.0         4.0       4000   
3          33          50000                4.0         0.0       7000   
4          26         102000                8.0         3.0      15000   

   loan_int_rate  loan_percent_income  cb_person_default_on_file  \
0          15.76                 0.36                          1   
1          12.68                 0.10                          2   
2          17.19                 0.13                          2   
3           8.90                 0.14                          1   
4          16.32                 0.15                          2   

   cb_person_cred_hist_length  
0                           2  
1                           4  
2                           2  
3                           7  
4                           4  
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">updating</span> <span class="n">the</span> <span class="n">test</span> <span class="n">data</span> <span class="n">accordingly</span> 
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="c1"># Assuming the file is saved in the environment as &#39;updatedtestdata.csv&#39;</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="s2">&quot;updatedtestdata.csv&quot;</span>

<span class="c1"># Load the dataset</span>
<span class="n">df_updated_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="n">file_path</span><span class="p">)</span>

<span class="c1"># Columns to be removed (replace with your desired columns)</span>
<span class="n">columns_to_remove</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;loan_grade&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">,</span><span class="s1">&#39;loan_percent_income&#39;</span><span class="p">]</span>  <span class="c1"># Replace &#39;column1&#39;, &#39;column2&#39; with actual column names</span>

<span class="c1"># Remove specified columns</span>
<span class="n">df_test_variance</span> <span class="o">=</span> <span class="n">df_updated_test</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns_to_remove</span><span class="p">)</span>

<span class="c1"># Save the new dataframe as &#39;test_variance.csv&#39;</span>
<span class="n">output_path</span> <span class="o">=</span> <span class="s2">&quot;test_variance.csv&quot;</span>
<span class="n">df_test_variance</span><span class="o">.</span><span class="n">to_csv</span><span class="p">(</span><span class="n">output_path</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>

<span class="c1"># Display the first few rows of the modified dataset</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_test_variance</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>   person_age  person_income  person_emp_length  loan_amnt  loan_int_rate  \
0          23          69000                3.0      25000          15.76   
1          26          96000                6.0      10000          12.68   
2          26          30000                5.0       4000          17.19   
3          33          50000                4.0       7000           8.90   
4          26         102000                8.0      15000          16.32   

   cb_person_cred_hist_length  
0                           2  
1                           4  
2                           2  
3                           7  
4                           4  
</pre></div>
</div>
</div>
</div>
<p>deplyomnet along with logging to dagshub</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.pipeline</span> <span class="kn">import</span> <span class="n">Pipeline</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span><span class="p">,</span> <span class="n">OneHotEncoder</span>
<span class="kn">from</span> <span class="nn">sklearn.compose</span> <span class="kn">import</span> <span class="n">ColumnTransformer</span>
<span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span><span class="p">,</span> <span class="n">RidgeClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>
<span class="kn">import</span> <span class="nn">seaborn</span> <span class="k">as</span> <span class="nn">sns</span>

<span class="c1"># Load data from fourthupdate.csv</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;fourthupdate.csv&quot;</span><span class="p">)</span>

<span class="c1"># Separate target variable</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># Features (excluding target)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>  <span class="c1"># Target variable</span>

<span class="c1"># Handling NaN values</span>
<span class="n">X</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">y</span><span class="o">.</span><span class="n">dropna</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Train-test split</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">stratify</span><span class="o">=</span><span class="n">y</span><span class="p">)</span>

<span class="c1"># Identify numerical and categorical columns</span>
<span class="n">numerical_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;int64&quot;</span><span class="p">,</span> <span class="s2">&quot;float64&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>
<span class="n">categorical_features</span> <span class="o">=</span> <span class="n">X_train</span><span class="o">.</span><span class="n">select_dtypes</span><span class="p">(</span><span class="n">include</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;object&quot;</span><span class="p">,</span> <span class="s2">&quot;category&quot;</span><span class="p">])</span><span class="o">.</span><span class="n">columns</span>

<span class="c1"># Preprocessing Pipelines</span>
<span class="n">numerical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;scaler&quot;</span><span class="p">,</span> <span class="n">StandardScaler</span><span class="p">())</span>
<span class="p">])</span>

<span class="n">categorical_transformer</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;onehot&quot;</span><span class="p">,</span> <span class="n">OneHotEncoder</span><span class="p">(</span><span class="n">handle_unknown</span><span class="o">=</span><span class="s2">&quot;ignore&quot;</span><span class="p">))</span>
<span class="p">])</span>

<span class="n">preprocessor</span> <span class="o">=</span> <span class="n">ColumnTransformer</span><span class="p">(</span><span class="n">transformers</span><span class="o">=</span><span class="p">[</span>
    <span class="p">(</span><span class="s2">&quot;num&quot;</span><span class="p">,</span> <span class="n">numerical_transformer</span><span class="p">,</span> <span class="n">numerical_features</span><span class="p">),</span>
    <span class="p">(</span><span class="s2">&quot;cat&quot;</span><span class="p">,</span> <span class="n">categorical_transformer</span><span class="p">,</span> <span class="n">categorical_features</span><span class="p">)</span>
<span class="p">])</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/nithinyanna3/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Change path if needed</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;Default&quot;</span><span class="p">)</span>

<span class="c1"># Define models</span>
<span class="n">models</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s2">&quot;LogisticRegression&quot;</span><span class="p">:</span> <span class="n">LogisticRegression</span><span class="p">(</span><span class="n">max_iter</span><span class="o">=</span><span class="mi">500</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RidgeClassifier&quot;</span><span class="p">:</span> <span class="n">RidgeClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;RandomForestClassifier&quot;</span><span class="p">:</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">),</span>
    <span class="s2">&quot;XGBClassifier&quot;</span><span class="p">:</span> <span class="n">XGBClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span> <span class="n">use_label_encoder</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">eval_metric</span><span class="o">=</span><span class="s1">&#39;mlogloss&#39;</span><span class="p">)</span>
<span class="p">}</span>

<span class="c1"># Training and Logging Models</span>
<span class="k">for</span> <span class="n">model_name</span><span class="p">,</span> <span class="n">model</span> <span class="ow">in</span> <span class="n">models</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
    <span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">(</span><span class="n">run_name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_Variance&quot;</span><span class="p">):</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Training </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">...&quot;</span><span class="p">)</span>
        
        <span class="c1"># Full pipeline</span>
        <span class="n">pipeline</span> <span class="o">=</span> <span class="n">Pipeline</span><span class="p">(</span><span class="n">steps</span><span class="o">=</span><span class="p">[</span>
            <span class="p">(</span><span class="s2">&quot;preprocessor&quot;</span><span class="p">,</span> <span class="n">preprocessor</span><span class="p">),</span>
            <span class="p">(</span><span class="s2">&quot;classifier&quot;</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
        <span class="p">])</span>
        
        <span class="c1"># Train the model</span>
        <span class="n">pipeline</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
        
        <span class="c1"># Predict</span>
        <span class="n">y_pred</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>
        <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
        <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
        
        <span class="c1"># Print metrics</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model: </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score: </span><span class="si">{</span><span class="n">f1</span><span class="si">:</span><span class="s2">.4f</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion Matrix:</span><span class="se">\n</span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Extract confusion matrix values</span>
        <span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
        
        <span class="c1"># Print confusion matrix values</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positives (TP): </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Negatives (TN): </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Positives (FP): </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;False Negatives (FN): </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Visualize confusion matrix</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">figure</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mi">6</span><span class="p">,</span> <span class="mi">4</span><span class="p">))</span>
        <span class="n">sns</span><span class="o">.</span><span class="n">heatmap</span><span class="p">(</span><span class="n">cm</span><span class="p">,</span> <span class="n">annot</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">fmt</span><span class="o">=</span><span class="s2">&quot;d&quot;</span><span class="p">,</span> <span class="n">cmap</span><span class="o">=</span><span class="s2">&quot;Blues&quot;</span><span class="p">,</span> <span class="n">xticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">),</span> <span class="n">yticklabels</span><span class="o">=</span><span class="n">np</span><span class="o">.</span><span class="n">unique</span><span class="p">(</span><span class="n">y</span><span class="p">))</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">xlabel</span><span class="p">(</span><span class="s1">&#39;Predicted&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">ylabel</span><span class="p">(</span><span class="s1">&#39;Actual&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Confusion Matrix - </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
        <span class="n">plt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
        
        <span class="c1"># Save the model using joblib</span>
        <span class="n">model_filename</span> <span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">_pipeline.joblib&quot;</span>
        <span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">pipeline</span><span class="p">,</span> <span class="n">model_filename</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Model saved as </span><span class="si">{</span><span class="n">model_filename</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        
        <span class="c1"># Log metrics and model to MLflow</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_param</span><span class="p">(</span><span class="s2">&quot;model_name&quot;</span><span class="p">,</span> <span class="n">model_name</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
        <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>
        
        <span class="c1"># Predict for the first 5 rows of test data</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">Predictions on first 5 rows of test_variance using </span><span class="si">{</span><span class="n">model_name</span><span class="si">}</span><span class="s2">:&quot;</span><span class="p">)</span>
        <span class="n">test_variance</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;test_variance.csv&quot;</span><span class="p">)</span>
        <span class="n">predictions</span> <span class="o">=</span> <span class="n">pipeline</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">test_variance</span><span class="o">.</span><span class="n">head</span><span class="p">(</span><span class="mi">5</span><span class="p">))</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">predictions</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;</span><span class="se">\n</span><span class="s2">All models have been trained, logged, and saved successfully.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Training LogisticRegression...
Model: LogisticRegression
Accuracy: 0.8582
F1 Score: 0.7927
Confusion Matrix:
[[9865    0]
 [1630    0]]
True Positives (TP): 9865
True Negatives (TN): 0
False Positives (FP): 1630
False Negatives (FN): 0
</pre></div>
</div>
<img alt="../_images/e7923994bf90dcaec52262df8771779ea15687185c5baf69c5e840791306af17.png" src="../_images/e7923994bf90dcaec52262df8771779ea15687185c5baf69c5e840791306af17.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as LogisticRegression_pipeline.joblib

Predictions on first 5 rows of test_variance using LogisticRegression:
[0. 0. 0. 0. 0.]
 View run LogisticRegression_Variance at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/7adc4544b4e048f9ae6f148345ce147c
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training RidgeClassifier...
Model: RidgeClassifier
Accuracy: 0.8582
F1 Score: 0.7927
Confusion Matrix:
[[9865    0]
 [1630    0]]
True Positives (TP): 9865
True Negatives (TN): 0
False Positives (FP): 1630
False Negatives (FN): 0
</pre></div>
</div>
<img alt="../_images/e8b17653a57fa355732ca9bf3bddfbdefef59389125b41d9381399f2cb329890.png" src="../_images/e8b17653a57fa355732ca9bf3bddfbdefef59389125b41d9381399f2cb329890.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as RidgeClassifier_pipeline.joblib

Predictions on first 5 rows of test_variance using RidgeClassifier:
[0. 0. 0. 0. 0.]
 View run RidgeClassifier_Variance at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/09fcc6bef97448b190f27e428ce5a0bf
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training RandomForestClassifier...
Model: RandomForestClassifier
Accuracy: 0.8554
F1 Score: 0.7923
Confusion Matrix:
[[9827   38]
 [1624    6]]
True Positives (TP): 9827
True Negatives (TN): 6
False Positives (FP): 1624
False Negatives (FN): 38
</pre></div>
</div>
<img alt="../_images/c9648c6ea860b13a68b60a8aa8fb81e911b5227cfc82d919cb496de56a72940a.png" src="../_images/c9648c6ea860b13a68b60a8aa8fb81e911b5227cfc82d919cb496de56a72940a.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as RandomForestClassifier_pipeline.joblib

Predictions on first 5 rows of test_variance using RandomForestClassifier:
[0. 0. 0. 0. 0.]
 View run RandomForestClassifier_Variance at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/52644c1f354c4987b26ee160b363833d
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

Training XGBClassifier...
Model: XGBClassifier
Accuracy: 0.8574
F1 Score: 0.7927
Confusion Matrix:
[[9854   11]
 [1628    2]]
True Positives (TP): 9854
True Negatives (TN): 2
False Positives (FP): 1628
False Negatives (FN): 11
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>C:\Users\HP\anaconda3\Lib\site-packages\xgboost\core.py:158: UserWarning: [15:11:49] WARNING: C:\buildkite-agent\builds\buildkite-windows-cpu-autoscaling-group-i-0c55ff5f71b100e98-1\xgboost\xgboost-ci-windows\src\learner.cc:740: 
Parameters: { &quot;use_label_encoder&quot; } are not used.

  warnings.warn(smsg, UserWarning)
</pre></div>
</div>
<img alt="../_images/51f0c32ba0b29283d944b1551edb47adcf35704f5f61766ac778eac46028e7a7.png" src="../_images/51f0c32ba0b29283d944b1551edb47adcf35704f5f61766ac778eac46028e7a7.png" />
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Model saved as XGBClassifier_pipeline.joblib

Predictions on first 5 rows of test_variance using XGBClassifier:
[0 0 0 0 0]
 View run XGBClassifier_Variance at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0/runs/a9122eb3c2a84bda89bdc0b3994da7cc
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/0

All models have been trained, logged, and saved successfully.
</pre></div>
</div>
</div>
</div>
<p>Use PCA for dimensionality reduction on all the features and testing it on random forest</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.ensemble</span> <span class="kn">import</span> <span class="n">RandomForestClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Standardization</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Split the dataset into training and testing sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Determine number of components for 95% explained variance</span>
<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="n">cumulative_explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_explained_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components selected for 95% explained variance: </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Apply PCA with the selected number of components</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Train RandomForest model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">RandomForestClassifier</span><span class="p">(</span><span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Save model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;random_forest_pca_model.joblib&quot;</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/nithinyanna3/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Change path if needed</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;PCA&quot;</span><span class="p">)</span>

<span class="c1"># Log model to MLflow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;RandomForest_PCA_Model&quot;</span><span class="p">)</span>

    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pca</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="c1"># Confusion Matrix</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Random Forest with PCA Classification Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score (weighted): </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion Matrix:</span><span class="se">\n</span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positive (TP): </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">, False Negative (FN): </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, False Positive (FP): </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">, True Negative (TN): </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Test with 5 rows from updatedtestdata.csv</span>
    <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;updatedtestdata.csv&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;loan_status&quot;</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">X_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">y_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">X_test_sample_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample</span><span class="p">)</span>
        <span class="n">X_test_sample_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample_scaled</span><span class="p">)</span>
        <span class="n">y_test_sample_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_sample_pca</span><span class="p">)</span>

        <span class="c1"># Print 5 test samples predictions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: Predicted loan_status = </span><span class="si">{</span><span class="n">y_test_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, Actual loan_status = </span><span class="si">{</span><span class="n">y_test_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The &#39;loan_status&#39; column is missing in the test dataset.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model training and logging completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components selected for 95% explained variance: 5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 15:39:17 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Random Forest with PCA Classification Metrics:
Accuracy: 0.8995005167068549
F1 Score (weighted): 0.8908174486589133
Confusion Matrix:
[[9611  299]
 [ 868  834]]
True Positive (TP): 9611, False Negative (FN): 299, False Positive (FP): 868, True Negative (TN): 834
The &#39;loan_status&#39; column is missing in the test dataset.
 View run charming-bass-298 at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5/runs/b656d71806fb4f22af40c29e6fb28b13
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5
Model training and logging completed.
</pre></div>
</div>
</div>
</div>
<p>the custom experiment i performed is KNN with PCA and logged into dagshub</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.neighbors</span> <span class="kn">import</span> <span class="n">KNeighborsClassifier</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Standardization</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Split the dataset into training and testing sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Determine number of components for 95% explained variance</span>
<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="n">cumulative_explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_explained_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components selected for 95% explained variance: </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Apply PCA with the selected number of components</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Train KNN model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">KNeighborsClassifier</span><span class="p">(</span><span class="n">n_neighbors</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Save model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;knn_pca_model.joblib&quot;</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/nithinyanna3/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Change path if needed</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;PCA&quot;</span><span class="p">)</span>

<span class="c1"># Log model to MLflow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;KNN_PCA_Model&quot;</span><span class="p">)</span>

    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pca</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="c1"># Confusion Matrix</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;KNN with PCA Classification Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score (weighted): </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion Matrix:</span><span class="se">\n</span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positive (TP): </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">, False Negative (FN): </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, False Positive (FP): </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">, True Negative (TN): </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
 <span class="c1"># Test with 5 rows from updatedtestdata.csv</span>
    <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;updatedtestdata.csv&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;loan_status&quot;</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">X_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">y_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">X_test_sample_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample</span><span class="p">)</span>
        <span class="n">X_test_sample_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample_scaled</span><span class="p">)</span>
        <span class="n">y_test_sample_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_sample_pca</span><span class="p">)</span>

        <span class="c1"># Print 5 test samples predictions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: Predicted loan_status = </span><span class="si">{</span><span class="n">y_test_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, Actual loan_status = </span><span class="si">{</span><span class="n">y_test_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The &#39;loan_status&#39; column is missing in the test dataset.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model training and logging completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components selected for 95% explained variance: 5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 15:47:13 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>KNN with PCA Classification Metrics:
Accuracy: 0.8944195659662418
F1 Score (weighted): 0.8865163979822601
Confusion Matrix:
[[9550  360]
 [ 866  836]]
True Positive (TP): 9550, False Negative (FN): 360, False Positive (FP): 866, True Negative (TN): 836
The &#39;loan_status&#39; column is missing in the test dataset.
 View run nosy-fowl-4 at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5/runs/2ebe3c8c0a914053b6c42cf1b4ccd2ef
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5
Model training and logging completed.
</pre></div>
</div>
</div>
</div>
<p>the second custom experiment i performed is SVM with PCA</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">mlflow.sklearn</span>
<span class="kn">from</span> <span class="nn">sklearn.decomposition</span> <span class="kn">import</span> <span class="n">PCA</span>
<span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="kn">from</span> <span class="nn">sklearn.svm</span> <span class="kn">import</span> <span class="n">SVC</span>
<span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">accuracy_score</span><span class="p">,</span> <span class="n">f1_score</span><span class="p">,</span> <span class="n">confusion_matrix</span>
<span class="kn">from</span> <span class="nn">sklearn.preprocessing</span> <span class="kn">import</span> <span class="n">StandardScaler</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load dataset</span>
<span class="n">df</span> <span class="o">=</span> <span class="n">secondupdate</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

<span class="c1"># Separate features and target</span>
<span class="n">X</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">drop</span><span class="p">(</span><span class="s2">&quot;loan_status&quot;</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
<span class="n">y</span> <span class="o">=</span> <span class="n">df</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span>

<span class="c1"># Standardization</span>
<span class="n">scaler</span> <span class="o">=</span> <span class="n">StandardScaler</span><span class="p">()</span>
<span class="n">X_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X</span><span class="p">)</span>

<span class="c1"># Split the dataset into training and testing sets</span>
<span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X_scaled</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>

<span class="c1"># PCA</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">()</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Determine number of components for 95% explained variance</span>
<span class="n">explained_variance</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">explained_variance_ratio_</span>
<span class="n">cumulative_explained_variance</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">cumsum</span><span class="p">(</span><span class="n">explained_variance</span><span class="p">)</span>
<span class="n">n_components</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">argmax</span><span class="p">(</span><span class="n">cumulative_explained_variance</span> <span class="o">&gt;=</span> <span class="mf">0.95</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Number of components selected for 95% explained variance: </span><span class="si">{</span><span class="n">n_components</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

<span class="c1"># Apply PCA with the selected number of components</span>
<span class="n">pca</span> <span class="o">=</span> <span class="n">PCA</span><span class="p">(</span><span class="n">n_components</span><span class="o">=</span><span class="n">n_components</span><span class="p">)</span>
<span class="n">X_train_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">fit_transform</span><span class="p">(</span><span class="n">X_train</span><span class="p">)</span>
<span class="n">X_test_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test</span><span class="p">)</span>

<span class="c1"># Train SVM model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">SVC</span><span class="p">(</span><span class="n">kernel</span><span class="o">=</span><span class="s1">&#39;rbf&#39;</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train_pca</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>

<span class="c1"># Save model using joblib</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;svm_pca_model.joblib&quot;</span><span class="p">)</span>

<span class="n">mlflow</span><span class="o">.</span><span class="n">set_tracking_uri</span><span class="p">(</span><span class="s2">&quot;https://dagshub.com/nithinyanna3/my-first-repo.mlflow&quot;</span><span class="p">)</span>  <span class="c1"># Change path if needed</span>
<span class="n">mlflow</span><span class="o">.</span><span class="n">set_experiment</span><span class="p">(</span><span class="s2">&quot;PCA&quot;</span><span class="p">)</span>

<span class="c1"># Log model to MLflow</span>
<span class="k">with</span> <span class="n">mlflow</span><span class="o">.</span><span class="n">start_run</span><span class="p">():</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">sklearn</span><span class="o">.</span><span class="n">log_model</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s2">&quot;SVM_PCA_Model&quot;</span><span class="p">)</span>

    <span class="c1"># Predictions</span>
    <span class="n">y_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_pca</span><span class="p">)</span>
    <span class="n">acc</span> <span class="o">=</span> <span class="n">accuracy_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>
    <span class="n">f1</span> <span class="o">=</span> <span class="n">f1_score</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">,</span> <span class="n">average</span><span class="o">=</span><span class="s1">&#39;weighted&#39;</span><span class="p">)</span>
    <span class="n">cm</span> <span class="o">=</span> <span class="n">confusion_matrix</span><span class="p">(</span><span class="n">y_test</span><span class="p">,</span> <span class="n">y_pred</span><span class="p">)</span>

    <span class="c1"># Log metrics</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;accuracy&quot;</span><span class="p">,</span> <span class="n">acc</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;f1_score&quot;</span><span class="p">,</span> <span class="n">f1</span><span class="p">)</span>

    <span class="c1"># Confusion Matrix</span>
    <span class="n">tp</span><span class="p">,</span> <span class="n">fn</span><span class="p">,</span> <span class="n">fp</span><span class="p">,</span> <span class="n">tn</span> <span class="o">=</span> <span class="n">cm</span><span class="o">.</span><span class="n">ravel</span><span class="p">()</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TP&quot;</span><span class="p">,</span> <span class="n">tp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;TN&quot;</span><span class="p">,</span> <span class="n">tn</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FP&quot;</span><span class="p">,</span> <span class="n">fp</span><span class="p">)</span>
    <span class="n">mlflow</span><span class="o">.</span><span class="n">log_metric</span><span class="p">(</span><span class="s2">&quot;FN&quot;</span><span class="p">,</span> <span class="n">fn</span><span class="p">)</span>

    <span class="c1"># Print results</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;SVM with PCA Classification Metrics:&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Accuracy: </span><span class="si">{</span><span class="n">acc</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;F1 Score (weighted): </span><span class="si">{</span><span class="n">f1</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Confusion Matrix:</span><span class="se">\n</span><span class="si">{</span><span class="n">cm</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;True Positive (TP): </span><span class="si">{</span><span class="n">tp</span><span class="si">}</span><span class="s2">, False Negative (FN): </span><span class="si">{</span><span class="n">fn</span><span class="si">}</span><span class="s2">, False Positive (FP): </span><span class="si">{</span><span class="n">fp</span><span class="si">}</span><span class="s2">, True Negative (TN): </span><span class="si">{</span><span class="n">tn</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="c1"># Test with 5 rows from updatedtestdata.csv</span>
    <span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;updatedtestdata.csv&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;loan_status&quot;</span> <span class="ow">in</span> <span class="n">df_test</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">X_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">y_test_sample</span> <span class="o">=</span> <span class="n">df_test</span><span class="p">[</span><span class="s2">&quot;loan_status&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">iloc</span><span class="p">[:</span><span class="mi">5</span><span class="p">]</span>
        <span class="n">X_test_sample_scaled</span> <span class="o">=</span> <span class="n">scaler</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample</span><span class="p">)</span>
        <span class="n">X_test_sample_pca</span> <span class="o">=</span> <span class="n">pca</span><span class="o">.</span><span class="n">transform</span><span class="p">(</span><span class="n">X_test_sample_scaled</span><span class="p">)</span>
        <span class="n">y_test_sample_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">X_test_sample_pca</span><span class="p">)</span>

        <span class="c1"># Print 5 test samples predictions</span>
        <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Row </span><span class="si">{</span><span class="n">i</span><span class="w"> </span><span class="o">+</span><span class="w"> </span><span class="mi">1</span><span class="si">}</span><span class="s2">: Predicted loan_status = </span><span class="si">{</span><span class="n">y_test_sample_pred</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">, Actual loan_status = </span><span class="si">{</span><span class="n">y_test_sample</span><span class="o">.</span><span class="n">iloc</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;The &#39;loan_status&#39; column is missing in the test dataset.&quot;</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Model training and logging completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Number of components selected for 95% explained variance: 5
</pre></div>
</div>
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>2024/12/17 15:55:43 WARNING mlflow.models.model: Model logged without a signature and input example. Please set `input_example` parameter when logging the model to auto infer the model signature.
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>SVM with PCA Classification Metrics:
Accuracy: 0.8965725111953152
F1 Score (weighted): 0.8827149247633431
Confusion Matrix:
[[9709  201]
 [1000  702]]
True Positive (TP): 9709, False Negative (FN): 201, False Positive (FP): 1000, True Negative (TN): 702
The &#39;loan_status&#39; column is missing in the test dataset.
 View run PCA with SVM at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5/runs/5790d03e0dc04550885c47f049ad18f1
 View experiment at: https://dagshub.com/nithinyanna3/my-first-repo.mlflow/#/experiments/5
Model training and logging completed.
</pre></div>
</div>
</div>
</div>
<p>Create meaningful F1-score plots and accuracies to compare experiments and determine the best model.</p>
<p>printing outpus from best model with 92% accuracy XGBoost</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">mlflow</span>
<span class="kn">import</span> <span class="nn">xgboost</span> <span class="k">as</span> <span class="nn">xgb</span>
<span class="kn">import</span> <span class="nn">joblib</span>

<span class="c1"># Load the saved XGBoost model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;xgb_classifier_model.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Load the test dataset</span>
<span class="n">df_test</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s2">&quot;updatedtestdata.csv&quot;</span><span class="p">)</span>

<span class="c1"># Predict</span>
<span class="n">y_test_sample_pred</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span>

<span class="c1"># Add predictions to the DataFrame</span>
<span class="n">df_test</span><span class="p">[</span><span class="s1">&#39;Predicted loan_status&#39;</span><span class="p">]</span> <span class="o">=</span> <span class="n">y_test_sample_pred</span>

<span class="c1"># Display the test data with predictions</span>
<span class="nb">print</span><span class="p">(</span><span class="n">df_test</span><span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Prediction on test data completed.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>       person_age  person_income  person_emp_length  loan_grade  loan_amnt  \
0              23          69000                3.0         5.0      25000   
1              26          96000                6.0         2.0      10000   
2              26          30000                5.0         4.0       4000   
3              33          50000                4.0         0.0       7000   
4              26         102000                8.0         3.0      15000   
...           ...            ...                ...         ...        ...   
39093          22          31200                2.0         1.0       3000   
39094          22          48000                6.0         0.0       7000   
39095          51          60000                0.0         0.0      15000   
39096          22          36000                4.0         3.0      14000   
39097          31          45000                6.0         1.0      19450   

       loan_int_rate  loan_percent_income  cb_person_default_on_file  \
0              15.76                 0.36                          1   
1              12.68                 0.10                          2   
2              17.19                 0.13                          2   
3               8.90                 0.14                          1   
4              16.32                 0.15                          2   
...              ...                  ...                        ...   
39093          10.37                 0.10                          1   
39094           6.03                 0.15                          1   
39095           7.51                 0.25                          1   
39096          15.62                 0.39                          2   
39097           9.91                 0.44                          1   

       cb_person_cred_hist_length  Predicted loan_status  
0                               2                      1  
1                               4                      0  
2                               2                      1  
3                               7                      0  
4                               4                      0  
...                           ...                    ...  
39093                           4                      0  
39094                           3                      0  
39095                          25                      0  
39096                           4                      1  
39097                           9                      1  

[39098 rows x 10 columns]
Prediction on test data completed.
</pre></div>
</div>
</div>
</div>
<p>Save the final model using joblib.
Create a FastAPI application to serve the model.
Containerize the FastAPI application using Docker and push to Docker Hub.
Deploy the containerized API to a cloud platform.</p>
<p>Create a Streamlit app to interact with the deployed model for real-time classification.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">scikit</span><span class="o">-</span><span class="n">learn</span> <span class="n">joblib</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: scikit-learn in c:\users\hp\anaconda3\lib\site-packages (1.4.2)
Requirement already satisfied: joblib in c:\users\hp\anaconda3\lib\site-packages (1.4.2)
Requirement already satisfied: numpy&gt;=1.19.5 in c:\users\hp\anaconda3\lib\site-packages (from scikit-learn) (1.26.4)
Requirement already satisfied: scipy&gt;=1.6.0 in c:\users\hp\anaconda3\lib\site-packages (from scikit-learn) (1.13.1)
Requirement already satisfied: threadpoolctl&gt;=2.0.0 in c:\users\hp\anaconda3\lib\site-packages (from scikit-learn) (2.2.0)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>

<span class="c1"># Assuming &#39;model&#39; is your trained XGBoost model</span>
<span class="n">joblib</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="s1">&#39;xgb_classifier_model.pkl&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>[&#39;xgb_classifier_model.pkl&#39;]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">fastapi</span> <span class="n">uvicorn</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: fastapi in c:\users\hp\anaconda3\lib\site-packages (0.115.6)
Requirement already satisfied: uvicorn in c:\users\hp\anaconda3\lib\site-packages (0.34.0)
Requirement already satisfied: starlette&lt;0.42.0,&gt;=0.40.0 in c:\users\hp\anaconda3\lib\site-packages (from fastapi) (0.41.3)
Requirement already satisfied: pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4 in c:\users\hp\anaconda3\lib\site-packages (from fastapi) (2.5.3)
Requirement already satisfied: typing-extensions&gt;=4.8.0 in c:\users\hp\anaconda3\lib\site-packages (from fastapi) (4.11.0)
Requirement already satisfied: click&gt;=7.0 in c:\users\hp\anaconda3\lib\site-packages (from uvicorn) (8.1.7)
Requirement already satisfied: h11&gt;=0.8 in c:\users\hp\anaconda3\lib\site-packages (from uvicorn) (0.14.0)
Requirement already satisfied: colorama in c:\users\hp\anaconda3\lib\site-packages (from click&gt;=7.0-&gt;uvicorn) (0.4.6)
Requirement already satisfied: annotated-types&gt;=0.4.0 in c:\users\hp\anaconda3\lib\site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4-&gt;fastapi) (0.6.0)
Requirement already satisfied: pydantic-core==2.14.6 in c:\users\hp\anaconda3\lib\site-packages (from pydantic!=1.8,!=1.8.1,!=2.0.0,!=2.0.1,!=2.1.0,&lt;3.0.0,&gt;=1.7.4-&gt;fastapi) (2.14.6)
Requirement already satisfied: anyio&lt;5,&gt;=3.4.0 in c:\users\hp\anaconda3\lib\site-packages (from starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (4.2.0)
Requirement already satisfied: idna&gt;=2.8 in c:\users\hp\anaconda3\lib\site-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (3.7)
Requirement already satisfied: sniffio&gt;=1.1 in c:\users\hp\anaconda3\lib\site-packages (from anyio&lt;5,&gt;=3.4.0-&gt;starlette&lt;0.42.0,&gt;=0.40.0-&gt;fastapi) (1.3.0)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<p>local deployment of fastapi</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">nest_asyncio</span>

<span class="c1"># Apply nest_asyncio to fix event loop issues in Jupyter</span>
<span class="n">nest_asyncio</span><span class="o">.</span><span class="n">apply</span><span class="p">()</span>

<span class="c1"># Load the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;best_xgb_model_with_scaler.pkl&quot;</span><span class="p">)</span>

<span class="n">app</span> <span class="o">=</span> <span class="n">FastAPI</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">InputData</span><span class="p">(</span><span class="n">BaseModel</span><span class="p">):</span>
    <span class="n">person_age</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">person_income</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">person_emp_length</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">loan_grade</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">loan_amnt</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">loan_int_rate</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">loan_percent_income</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cb_person_default_on_file</span><span class="p">:</span> <span class="nb">float</span>
    <span class="n">cb_person_cred_hist_length</span><span class="p">:</span> <span class="nb">float</span>

<span class="nd">@app</span><span class="o">.</span><span class="n">post</span><span class="p">(</span><span class="s2">&quot;/predict&quot;</span><span class="p">)</span>
<span class="k">async</span> <span class="k">def</span> <span class="nf">predict</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">InputData</span><span class="p">):</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">input_features</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
            <span class="n">data</span><span class="o">.</span><span class="n">person_age</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">person_income</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">person_emp_length</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loan_grade</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loan_amnt</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loan_int_rate</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">loan_percent_income</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">cb_person_default_on_file</span><span class="p">,</span>
            <span class="n">data</span><span class="o">.</span><span class="n">cb_person_cred_hist_length</span><span class="p">,</span>
        <span class="p">])</span>
        
        <span class="c1"># Convert the array to a DataFrame with the appropriate column names</span>
        <span class="n">input_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([</span><span class="n">input_features</span><span class="p">],</span> <span class="n">columns</span><span class="o">=</span><span class="p">[</span>
            <span class="s1">&#39;person_age&#39;</span><span class="p">,</span> <span class="s1">&#39;person_income&#39;</span><span class="p">,</span> <span class="s1">&#39;person_emp_length&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_grade&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_percent_income&#39;</span><span class="p">,</span> 
            <span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_person_cred_hist_length&#39;</span>
        <span class="p">])</span>

        <span class="c1"># Make prediction</span>
        <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_df</span><span class="p">)</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;prediction&quot;</span><span class="p">:</span> <span class="nb">int</span><span class="p">(</span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">])}</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">{</span><span class="s2">&quot;error&quot;</span><span class="p">:</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)}</span>

<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">config</span> <span class="o">=</span> <span class="n">uvicorn</span><span class="o">.</span><span class="n">Config</span><span class="p">(</span><span class="n">app</span><span class="p">,</span> <span class="n">host</span><span class="o">=</span><span class="s2">&quot;127.0.0.1&quot;</span><span class="p">,</span> <span class="n">port</span><span class="o">=</span><span class="mi">8002</span><span class="p">,</span> <span class="n">log_level</span><span class="o">=</span><span class="s2">&quot;info&quot;</span><span class="p">)</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">uvicorn</span><span class="o">.</span><span class="n">Server</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
    <span class="k">await</span> <span class="n">server</span><span class="o">.</span><span class="n">serve</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>INFO:     Started server process [14084]
INFO:     Waiting for application startup.
INFO:     Application startup complete.
INFO:     Uvicorn running on http://127.0.0.1:8002 (Press CTRL+C to quit)
INFO:     Shutting down
INFO:     Waiting for application shutdown.
INFO:     Application shutdown complete.
INFO:     Finished server process [14084]
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="o">!</span>pip<span class="w"> </span>install<span class="w"> </span>docker<span class="w"> </span>render-python
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: docker in c:\users\hp\anaconda3\lib\site-packages (7.1.0)
Collecting render-python
  Downloading render_python-2.3.1-py3-none-any.whl.metadata (567 bytes)
Requirement already satisfied: pywin32&gt;=304 in c:\users\hp\anaconda3\lib\site-packages (from docker) (305.1)
Requirement already satisfied: requests&gt;=2.26.0 in c:\users\hp\anaconda3\lib\site-packages (from docker) (2.32.2)
Requirement already satisfied: urllib3&gt;=1.26.0 in c:\users\hp\anaconda3\lib\site-packages (from docker) (2.2.2)
Requirement already satisfied: decorator in c:\users\hp\anaconda3\lib\site-packages (from render-python) (5.1.1)
Requirement already satisfied: numpy in c:\users\hp\anaconda3\lib\site-packages (from render-python) (1.26.4)
Requirement already satisfied: pillow in c:\users\hp\anaconda3\lib\site-packages (from render-python) (10.3.0)
Requirement already satisfied: scipy in c:\users\hp\anaconda3\lib\site-packages (from render-python) (1.13.1)
Requirement already satisfied: six in c:\users\hp\anaconda3\lib\site-packages (from render-python) (1.16.0)
Collecting sphinxcontrib-napoleon (from render-python)
  Downloading sphinxcontrib_napoleon-0.7-py2.py3-none-any.whl.metadata (6.2 kB)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\hp\anaconda3\lib\site-packages (from requests&gt;=2.26.0-&gt;docker) (2.0.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\hp\anaconda3\lib\site-packages (from requests&gt;=2.26.0-&gt;docker) (3.7)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\hp\anaconda3\lib\site-packages (from requests&gt;=2.26.0-&gt;docker) (2024.8.30)
Collecting pockets&gt;=0.3 (from sphinxcontrib-napoleon-&gt;render-python)
  Downloading pockets-0.9.1-py2.py3-none-any.whl.metadata (4.4 kB)
Downloading render_python-2.3.1-py3-none-any.whl (67 kB)
Downloading sphinxcontrib_napoleon-0.7-py2.py3-none-any.whl (17 kB)
Downloading pockets-0.9.1-py2.py3-none-any.whl (26 kB)
Installing collected packages: pockets, sphinxcontrib-napoleon, render-python
Successfully installed pockets-0.9.1 render-python-2.3.1 sphinxcontrib-napoleon-0.7
</pre></div>
</div>
</div>
</div>
<p>working with dockerfile directory</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">dockerfile_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2"># Use the official Python image as the base image</span>
<span class="s2">FROM python:3.10-slim</span>

<span class="s2"># Set the working directory in the container</span>
<span class="s2">WORKDIR /app</span>

<span class="s2"># Copy the requirements file to the container</span>
<span class="s2">COPY requirements.txt .</span>

<span class="s2"># Install the required Python libraries</span>
<span class="s2">RUN pip install --no-cache-dir -r requirements.txt</span>

<span class="s2"># Copy the FastAPI app code to the container</span>
<span class="s2">COPY . .</span>

<span class="s2"># Expose the application port</span>
<span class="s2">EXPOSE 8001</span>

<span class="s2"># Command to run the application</span>
<span class="s2">CMD [&quot;uvicorn&quot;, &quot;main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8002&quot;]</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;Dockerfile&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dockerfile_content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">requirements_content</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">fastapi</span>
<span class="s2">uvicorn</span>
<span class="s2">numpy</span>
<span class="s2">pandas</span>
<span class="s2">joblib</span>
<span class="s2">nest_asyncio</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&quot;requirements.txt&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
    <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">requirements_content</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>

<span class="n">os</span><span class="o">.</span><span class="n">chdir</span><span class="p">(</span><span class="s2">&quot;C:</span><span class="se">\\</span><span class="s2">Users</span><span class="se">\\</span><span class="s2">HP&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mkdir</span> <span class="n">C</span><span class="p">:</span>\<span class="n">Users</span>\<span class="n">HP</span>\<span class="n">docker_build</span>
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">uvicorn</span>
<span class="kn">from</span> <span class="nn">fastapi</span> <span class="kn">import</span> <span class="n">FastAPI</span>
<span class="kn">from</span> <span class="nn">pydantic</span> <span class="kn">import</span> <span class="n">BaseModel</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">os</span>

<span class="c1"># Define the Python code as a string</span>
<span class="n">python_code</span> <span class="o">=</span> <span class="s2">&quot;&quot;&quot;</span>
<span class="s2">import uvicorn</span>
<span class="s2">from fastapi import FastAPI</span>
<span class="s2">from pydantic import BaseModel</span>
<span class="s2">import numpy as np</span>
<span class="s2">import pandas as pd</span>
<span class="s2">import joblib</span>

<span class="s2"># Load the model</span>
<span class="s2">model = joblib.load(&quot;best_xgb_model_with_scaler.pkl&quot;)</span>

<span class="s2"># Initialize the FastAPI app</span>
<span class="s2">app = FastAPI()</span>

<span class="s2"># Define the input data schema</span>
<span class="s2">class InputData(BaseModel):</span>
<span class="s2">    person_age: float</span>
<span class="s2">    person_income: float</span>
<span class="s2">    person_emp_length: float</span>
<span class="s2">    loan_grade: float</span>
<span class="s2">    loan_amnt: float</span>
<span class="s2">    loan_int_rate: float</span>
<span class="s2">    loan_percent_income: float</span>
<span class="s2">    cb_person_default_on_file: float</span>
<span class="s2">    cb_person_cred_hist_length: float</span>

<span class="s2"># Prediction endpoint</span>
<span class="s2">@app.post(&quot;/predict&quot;)</span>
<span class="s2">async def predict(data: InputData):</span>
<span class="s2">    try:</span>
<span class="s2">        # Prepare the input features for the model</span>
<span class="s2">        input_features = np.array([</span>
<span class="s2">            data.person_age,</span>
<span class="s2">            data.person_income,</span>
<span class="s2">            data.person_emp_length,</span>
<span class="s2">            data.loan_grade,</span>
<span class="s2">            data.loan_amnt,</span>
<span class="s2">            data.loan_int_rate,</span>
<span class="s2">            data.loan_percent_income,</span>
<span class="s2">            data.cb_person_default_on_file,</span>
<span class="s2">            data.cb_person_cred_hist_length,</span>
<span class="s2">        ])</span>
<span class="s2">        </span>
<span class="s2">        # Convert to a DataFrame</span>
<span class="s2">        input_df = pd.DataFrame([input_features], columns=[</span>
<span class="s2">            &#39;person_age&#39;, &#39;person_income&#39;, &#39;person_emp_length&#39;, &#39;loan_grade&#39;, </span>
<span class="s2">            &#39;loan_amnt&#39;, &#39;loan_int_rate&#39;, &#39;loan_percent_income&#39;, </span>
<span class="s2">            &#39;cb_person_default_on_file&#39;, &#39;cb_person_cred_hist_length&#39;</span>
<span class="s2">        ])</span>

<span class="s2">        # Make a prediction</span>
<span class="s2">        prediction = model.predict(input_df)</span>
<span class="s2">        return {&quot;prediction&quot;: int(prediction[0])}</span>
<span class="s2">    except Exception as e:</span>
<span class="s2">        # Return error details if something goes wrong</span>
<span class="s2">        return {&quot;error&quot;: str(e)}</span>

<span class="s2">if __name__ == &quot;__main__&quot;:</span>
<span class="s2">    uvicorn.run(app, host=&quot;0.0.0.0&quot;, port=8002, log_level=&quot;info&quot;)</span>
<span class="s2">&quot;&quot;&quot;</span>

<span class="c1"># Define the target directory</span>
<span class="n">target_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\HP\docker_build&quot;</span>

<span class="c1"># Create the target directory if it doesn&#39;t exist</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Save the script as main.py in the target directory</span>
<span class="n">file_path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="s2">&quot;main.py&quot;</span><span class="p">)</span>
<span class="k">try</span><span class="p">:</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">file_path</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span> <span class="k">as</span> <span class="n">file</span><span class="p">:</span>
        <span class="n">file</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">python_code</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;main.py saved successfully in </span><span class="si">{</span><span class="n">target_dir</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error saving main.py: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>main.py saved successfully in C:\Users\HP\docker_build
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">os</span>
<span class="kn">import</span> <span class="nn">shutil</span>

<span class="c1"># Create target directory if it doesn&#39;t exist</span>
<span class="n">target_dir</span> <span class="o">=</span> <span class="sa">r</span><span class="s2">&quot;C:\Users\HP\docker_build&quot;</span>
<span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="n">target_dir</span><span class="p">,</span> <span class="n">exist_ok</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

<span class="c1"># Move the Dockerfile</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\HP\Dockerfile&quot;</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>

<span class="c1"># Move other necessary files (example: requirements.txt)</span>
<span class="n">shutil</span><span class="o">.</span><span class="n">move</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;C:\Users\HP\requirements.txt&quot;</span><span class="p">,</span> <span class="n">target_dir</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output text_plain highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>&#39;C:\\Users\\HP\\docker_build\\requirements.txt&#39;
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">docker</span>

<span class="c1"># Initialize Docker client</span>
<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>

<span class="c1"># Build the Docker image</span>
<span class="k">try</span><span class="p">:</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">build_logs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">build</span><span class="p">(</span>
        <span class="n">path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;C:\Users\HP\docker_build&quot;</span><span class="p">,</span>
        <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;nithinyanna/fastapi-app:v1&quot;</span>
    <span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Docker image built successfully!&quot;</span><span class="p">)</span>
<span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Error building Docker image: </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stderr highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Task exception was never retrieved
future: &lt;Task finished name=&#39;Task-1&#39; coro=&lt;Server.serve() done, defined at C:\Users\HP\anaconda3\Lib\site-packages\uvicorn\server.py:68&gt; exception=KeyboardInterrupt()&gt;
Traceback (most recent call last):
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\uvicorn\main.py&quot;, line 579, in run
    server.run()
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\uvicorn\server.py&quot;, line 66, in run
    return asyncio.run(self.serve(sockets=sockets))
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\nest_asyncio.py&quot;, line 30, in run
    return loop.run_until_complete(task)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\nest_asyncio.py&quot;, line 92, in run_until_complete
    self._run_once()
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\nest_asyncio.py&quot;, line 133, in _run_once
    handle._run()
  File &quot;C:\Users\HP\anaconda3\Lib\asyncio\events.py&quot;, line 88, in _run
    self._context.run(self._callback, *self._args)
  File &quot;C:\Users\HP\anaconda3\Lib\asyncio\tasks.py&quot;, line 396, in __wakeup
    self.__step()
  File &quot;C:\Users\HP\anaconda3\Lib\asyncio\tasks.py&quot;, line 303, in __step
    self.__step_run_and_handle_result(exc)
  File &quot;C:\Users\HP\anaconda3\Lib\asyncio\tasks.py&quot;, line 314, in __step_run_and_handle_result
    result = coro.send(None)
             ^^^^^^^^^^^^^^^
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\uvicorn\server.py&quot;, line 69, in serve
    with self.capture_signals():
  File &quot;C:\Users\HP\anaconda3\Lib\contextlib.py&quot;, line 144, in __exit__
    next(self.gen)
  File &quot;C:\Users\HP\anaconda3\Lib\site-packages\uvicorn\server.py&quot;, line 330, in capture_signals
    signal.raise_signal(captured_signal)
KeyboardInterrupt
C:\Users\HP\anaconda3\Lib\site-packages\paramiko\transport.py:219: CryptographyDeprecationWarning: Blowfish has been deprecated and will be removed in a future release
  &quot;class&quot;: algorithms.Blowfish,
</pre></div>
</div>
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Docker image built successfully!
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">docker</span>

<span class="n">client</span> <span class="o">=</span> <span class="n">docker</span><span class="o">.</span><span class="n">from_env</span><span class="p">()</span>

<span class="k">try</span><span class="p">:</span>
    <span class="n">image</span><span class="p">,</span> <span class="n">logs</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">build</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="sa">r</span><span class="s2">&quot;C:\Users\HP\docker_build&quot;</span><span class="p">,</span> <span class="n">tag</span><span class="o">=</span><span class="s2">&quot;nithinyanna/fastapi-app:v1&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Docker image built successfully!&quot;</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Image ID: </span><span class="si">{</span><span class="n">image</span><span class="o">.</span><span class="n">id</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="c1"># Print build logs (optional)</span>
    <span class="k">for</span> <span class="n">log</span> <span class="ow">in</span> <span class="n">logs</span><span class="p">:</span>
        <span class="k">if</span> <span class="s1">&#39;stream&#39;</span> <span class="ow">in</span> <span class="n">log</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="n">log</span><span class="p">[</span><span class="s1">&#39;stream&#39;</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
<span class="k">except</span> <span class="n">docker</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">BuildError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Error during build:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
<span class="k">except</span> <span class="n">docker</span><span class="o">.</span><span class="n">errors</span><span class="o">.</span><span class="n">APIError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
    <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Docker API error:&quot;</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Docker image built successfully!
Image ID: sha256:24ce2b9269b6b9760d33bf0e03423fdb99f567b49dd8e094b79535285042fd54
Step 1/7 : FROM python:3.10-slim

---&gt; 61912260e578
Step 2/7 : WORKDIR /app

---&gt; Using cache
---&gt; 4496453a7ea0
Step 3/7 : COPY requirements.txt .

---&gt; Using cache
---&gt; aa7de811e07f
Step 4/7 : RUN pip install --no-cache-dir -r requirements.txt

---&gt; Using cache
---&gt; e7a5aeec47fc
Step 5/7 : COPY . .

---&gt; Using cache
---&gt; 1f55e8daf29f
Step 6/7 : EXPOSE 8001

---&gt; Using cache
---&gt; e59cb9fd0778
Step 7/7 : CMD [&quot;uvicorn&quot;, &quot;main:app&quot;, &quot;--host&quot;, &quot;0.0.0.0&quot;, &quot;--port&quot;, &quot;8002&quot;]

---&gt; Using cache
---&gt; 24ce2b9269b6
Successfully built 24ce2b9269b6
Successfully tagged nithinyanna/fastapi-app:v1
</pre></div>
</div>
</div>
</div>
<p>successfully created dockerimages</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">client</span><span class="o">.</span><span class="n">login</span><span class="p">(</span><span class="n">username</span><span class="o">=</span><span class="s2">&quot;nithinyanna&quot;</span><span class="p">,</span> <span class="n">password</span><span class="o">=</span><span class="s2">&quot;N@ithin789&quot;</span><span class="p">)</span>
<span class="n">client</span><span class="o">.</span><span class="n">images</span><span class="o">.</span><span class="n">push</span><span class="p">(</span><span class="s2">&quot;nithinyanna/fastapi-app:v1&quot;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Docker image pushed to Docker Hub.&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Docker image pushed to Docker Hub.
</pre></div>
</div>
</div>
</div>
<p>to deply the model using cloud i have used render cloud which is easy and reliable and below is the loal deplyment of streamlitt application</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">pip</span> <span class="n">install</span> <span class="n">streamlit</span>
</pre></div>
</div>
</div>
<div class="cell_output docutils container">
<div class="output stream highlight-myst-ansi notranslate"><div class="highlight"><pre><span></span>Requirement already satisfied: streamlit in c:\users\hp\anaconda3\lib\site-packages (1.32.0)
Requirement already satisfied: altair&lt;6,&gt;=4.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (5.0.1)
Requirement already satisfied: blinker&lt;2,&gt;=1.0.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (1.6.2)
Requirement already satisfied: cachetools&lt;6,&gt;=4.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (5.3.3)
Requirement already satisfied: click&lt;9,&gt;=7.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (8.1.7)
Requirement already satisfied: numpy&lt;2,&gt;=1.19.3 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (1.26.4)
Requirement already satisfied: packaging&lt;24,&gt;=16.8 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (23.2)
Requirement already satisfied: pandas&lt;3,&gt;=1.3.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (2.2.2)
Requirement already satisfied: pillow&lt;11,&gt;=7.1.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (10.3.0)
Requirement already satisfied: protobuf&lt;5,&gt;=3.20 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (3.20.3)
Requirement already satisfied: pyarrow&gt;=7.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (14.0.2)
Requirement already satisfied: requests&lt;3,&gt;=2.27 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (2.32.2)
Requirement already satisfied: rich&lt;14,&gt;=10.14.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (13.3.5)
Requirement already satisfied: tenacity&lt;9,&gt;=8.1.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (8.2.2)
Requirement already satisfied: toml&lt;2,&gt;=0.10.1 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (0.10.2)
Requirement already satisfied: typing-extensions&lt;5,&gt;=4.3.0 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (4.11.0)
Requirement already satisfied: gitpython!=3.1.19,&lt;4,&gt;=3.0.7 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (3.1.37)
Requirement already satisfied: pydeck&lt;1,&gt;=0.8.0b4 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (0.8.0)
Requirement already satisfied: tornado&lt;7,&gt;=6.0.3 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (6.4.1)
Requirement already satisfied: watchdog&gt;=2.1.5 in c:\users\hp\anaconda3\lib\site-packages (from streamlit) (4.0.1)
Requirement already satisfied: jinja2 in c:\users\hp\anaconda3\lib\site-packages (from altair&lt;6,&gt;=4.0-&gt;streamlit) (3.1.4)
Requirement already satisfied: jsonschema&gt;=3.0 in c:\users\hp\anaconda3\lib\site-packages (from altair&lt;6,&gt;=4.0-&gt;streamlit) (4.19.2)
Requirement already satisfied: toolz in c:\users\hp\anaconda3\lib\site-packages (from altair&lt;6,&gt;=4.0-&gt;streamlit) (0.12.0)
Requirement already satisfied: colorama in c:\users\hp\anaconda3\lib\site-packages (from click&lt;9,&gt;=7.0-&gt;streamlit) (0.4.6)
Requirement already satisfied: gitdb&lt;5,&gt;=4.0.1 in c:\users\hp\anaconda3\lib\site-packages (from gitpython!=3.1.19,&lt;4,&gt;=3.0.7-&gt;streamlit) (4.0.7)
Requirement already satisfied: python-dateutil&gt;=2.8.2 in c:\users\hp\anaconda3\lib\site-packages (from pandas&lt;3,&gt;=1.3.0-&gt;streamlit) (2.9.0.post0)
Requirement already satisfied: pytz&gt;=2020.1 in c:\users\hp\anaconda3\lib\site-packages (from pandas&lt;3,&gt;=1.3.0-&gt;streamlit) (2024.1)
Requirement already satisfied: tzdata&gt;=2022.7 in c:\users\hp\anaconda3\lib\site-packages (from pandas&lt;3,&gt;=1.3.0-&gt;streamlit) (2023.3)
Requirement already satisfied: charset-normalizer&lt;4,&gt;=2 in c:\users\hp\anaconda3\lib\site-packages (from requests&lt;3,&gt;=2.27-&gt;streamlit) (2.0.4)
Requirement already satisfied: idna&lt;4,&gt;=2.5 in c:\users\hp\anaconda3\lib\site-packages (from requests&lt;3,&gt;=2.27-&gt;streamlit) (3.7)
Requirement already satisfied: urllib3&lt;3,&gt;=1.21.1 in c:\users\hp\anaconda3\lib\site-packages (from requests&lt;3,&gt;=2.27-&gt;streamlit) (2.2.2)
Requirement already satisfied: certifi&gt;=2017.4.17 in c:\users\hp\anaconda3\lib\site-packages (from requests&lt;3,&gt;=2.27-&gt;streamlit) (2024.8.30)
Requirement already satisfied: markdown-it-py&lt;3.0.0,&gt;=2.2.0 in c:\users\hp\anaconda3\lib\site-packages (from rich&lt;14,&gt;=10.14.0-&gt;streamlit) (2.2.0)
Requirement already satisfied: pygments&lt;3.0.0,&gt;=2.13.0 in c:\users\hp\anaconda3\lib\site-packages (from rich&lt;14,&gt;=10.14.0-&gt;streamlit) (2.15.1)
Requirement already satisfied: smmap&lt;5,&gt;=3.0.1 in c:\users\hp\anaconda3\lib\site-packages (from gitdb&lt;5,&gt;=4.0.1-&gt;gitpython!=3.1.19,&lt;4,&gt;=3.0.7-&gt;streamlit) (4.0.0)
Requirement already satisfied: MarkupSafe&gt;=2.0 in c:\users\hp\anaconda3\lib\site-packages (from jinja2-&gt;altair&lt;6,&gt;=4.0-&gt;streamlit) (2.1.3)
Requirement already satisfied: attrs&gt;=22.2.0 in c:\users\hp\anaconda3\lib\site-packages (from jsonschema&gt;=3.0-&gt;altair&lt;6,&gt;=4.0-&gt;streamlit) (23.1.0)
Requirement already satisfied: jsonschema-specifications&gt;=2023.03.6 in c:\users\hp\anaconda3\lib\site-packages (from jsonschema&gt;=3.0-&gt;altair&lt;6,&gt;=4.0-&gt;streamlit) (2023.7.1)
Requirement already satisfied: referencing&gt;=0.28.4 in c:\users\hp\anaconda3\lib\site-packages (from jsonschema&gt;=3.0-&gt;altair&lt;6,&gt;=4.0-&gt;streamlit) (0.30.2)
Requirement already satisfied: rpds-py&gt;=0.7.1 in c:\users\hp\anaconda3\lib\site-packages (from jsonschema&gt;=3.0-&gt;altair&lt;6,&gt;=4.0-&gt;streamlit) (0.10.6)
Requirement already satisfied: mdurl~=0.1 in c:\users\hp\anaconda3\lib\site-packages (from markdown-it-py&lt;3.0.0,&gt;=2.2.0-&gt;rich&lt;14,&gt;=10.14.0-&gt;streamlit) (0.1.0)
Requirement already satisfied: six&gt;=1.5 in c:\users\hp\anaconda3\lib\site-packages (from python-dateutil&gt;=2.8.2-&gt;pandas&lt;3,&gt;=1.3.0-&gt;streamlit) (1.16.0)
Note: you may need to restart the kernel to use updated packages.
</pre></div>
</div>
</div>
</div>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">streamlit</span> <span class="k">as</span> <span class="nn">st</span>
<span class="kn">import</span> <span class="nn">joblib</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Load the model</span>
<span class="n">model</span> <span class="o">=</span> <span class="n">joblib</span><span class="o">.</span><span class="n">load</span><span class="p">(</span><span class="s2">&quot;best_xgb_model_with_scaler.pkl&quot;</span><span class="p">)</span>

<span class="c1"># Streamlit app</span>
<span class="n">st</span><span class="o">.</span><span class="n">title</span><span class="p">(</span><span class="s2">&quot;Loan Default Prediction&quot;</span><span class="p">)</span>

<span class="c1"># Define input fields</span>
<span class="n">person_age</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Age&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">18</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">30</span><span class="p">)</span>
<span class="n">person_income</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Income&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">50000</span><span class="p">)</span>
<span class="n">person_emp_length</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Employment Length (in years)&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">50</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">loan_grade</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Loan Grade&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>
<span class="n">loan_amnt</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Loan Amount&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">10000</span><span class="p">)</span>
<span class="n">loan_int_rate</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Interest Rate (%)&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">5.0</span><span class="p">)</span>
<span class="n">loan_percent_income</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Loan </span><span class="si">% o</span><span class="s2">f Income&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mf">0.0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mf">10.0</span><span class="p">)</span>
<span class="n">cb_person_default_on_file</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Default on File&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">max_value</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">0</span><span class="p">)</span>
<span class="n">cb_person_cred_hist_length</span> <span class="o">=</span> <span class="n">st</span><span class="o">.</span><span class="n">number_input</span><span class="p">(</span><span class="s2">&quot;Credit History Length&quot;</span><span class="p">,</span> <span class="n">min_value</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span> <span class="n">value</span><span class="o">=</span><span class="mi">5</span><span class="p">)</span>

<span class="c1"># Create a DataFrame with the input data</span>
<span class="n">input_data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">([[</span><span class="n">person_age</span><span class="p">,</span> <span class="n">person_income</span><span class="p">,</span> <span class="n">person_emp_length</span><span class="p">,</span> <span class="n">loan_grade</span><span class="p">,</span>
                            <span class="n">loan_amnt</span><span class="p">,</span> <span class="n">loan_int_rate</span><span class="p">,</span> <span class="n">loan_percent_income</span><span class="p">,</span>
                            <span class="n">cb_person_default_on_file</span><span class="p">,</span> <span class="n">cb_person_cred_hist_length</span><span class="p">]],</span>
                          <span class="n">columns</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;person_age&#39;</span><span class="p">,</span> <span class="s1">&#39;person_income&#39;</span><span class="p">,</span> <span class="s1">&#39;person_emp_length&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_grade&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;loan_amnt&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_int_rate&#39;</span><span class="p">,</span> <span class="s1">&#39;loan_percent_income&#39;</span><span class="p">,</span>
                                   <span class="s1">&#39;cb_person_default_on_file&#39;</span><span class="p">,</span> <span class="s1">&#39;cb_person_cred_hist_length&#39;</span><span class="p">])</span>

<span class="c1"># Predict button</span>
<span class="k">if</span> <span class="n">st</span><span class="o">.</span><span class="n">button</span><span class="p">(</span><span class="s1">&#39;Predict&#39;</span><span class="p">):</span>
    <span class="n">prediction</span> <span class="o">=</span> <span class="n">model</span><span class="o">.</span><span class="n">predict</span><span class="p">(</span><span class="n">input_data</span><span class="p">)</span>
    <span class="n">st</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Prediction: </span><span class="si">{</span><span class="s1">&#39;Default&#39;</span><span class="w"> </span><span class="k">if</span><span class="w"> </span><span class="n">prediction</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="mi">1</span><span class="w"> </span><span class="k">else</span><span class="w"> </span><span class="s1">&#39;No Default&#39;</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>

    <script type="text/x-thebe-config">
    {
        requestKernel: true,
        binderOptions: {
            repo: "binder-examples/jupyter-stacks-datascience",
            ref: "master",
        },
        codeMirrorConfig: {
            theme: "abcdef",
            mode: "python"
        },
        kernelOptions: {
            name: "python3",
            path: "./content"
        },
        predefinedOutput: true
    }
    </script>
    <script>kernelName = 'python3'</script>

                </article>
              

              
              
              
              
                <footer class="prev-next-footer d-print-none">
                  
<div class="prev-next-area">
</div>
                </footer>
              
            </div>
            
            
              
                <dialog id="pst-secondary-sidebar-modal"></dialog>
                <div id="pst-secondary-sidebar" class="bd-sidebar-secondary bd-toc"><div class="sidebar-secondary-items sidebar-secondary__inner">


  <div class="sidebar-secondary-item">
  <div class="page-toc tocsection onthispage">
    <i class="fa-solid fa-list"></i> Contents
  </div>
  <nav class="bd-toc-nav page-toc">
    <ul class="simple visible nav section-nav flex-column">
</ul>

  </nav></div>

</div></div>
              
            
          </div>
          <footer class="bd-footer-content">
            
<div class="bd-footer-content__inner container">
  
  <div class="footer-item">
    
<p class="component-author">
By The Jupyter Book community
</p>

  </div>
  
  <div class="footer-item">
    

  <p class="copyright">
    
       Copyright 2023.
      <br/>
    
  </p>

  </div>
  
  <div class="footer-item">
    
  </div>
  
  <div class="footer-item">
    
  </div>
  
</div>
          </footer>
        

      </main>
    </div>
  </div>
  
  <!-- Scripts loaded after <body> so the DOM is not blocked -->
  <script defer src="../_static/scripts/bootstrap.js?digest=8878045cc6db502f8baf"></script>
<script defer src="../_static/scripts/pydata-sphinx-theme.js?digest=8878045cc6db502f8baf"></script>

  <footer class="bd-footer">
  </footer>
  </body>
</html>